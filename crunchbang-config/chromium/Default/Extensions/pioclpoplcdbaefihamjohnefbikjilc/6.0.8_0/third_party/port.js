"undefined"==typeof SAFARI&&function(){LEGACY_SAFARI=(SAFARI="undefined"!==typeof safari)&&534>(navigator.appVersion.match(/\sSafari\/(\d+)\./)||[null,0])[1];if(SAFARI){var h=!!safari.extension.bars,l=function(){if(safari.self&&safari.self.addEventListener)return safari.self;if(safari.application&&safari.application.addEventListener)return safari.application;console.log("No add/remove event listener possible at this location!");console.trace();return{addEventListener:function(){},removeEventListener:function(){}}},
d=function(a,b){var c=function(e){e.name==a&&b(e)};l().addEventListener("message",c,!1);return c},f=function(a){if(a&&a.target&&a.target.page&&a.target.page.dispatchMessage)return a.target.page;if((a=safari.self)&&a.tab&&a.tab.dispatchMessage)return a.tab;if((a=(a=safari.application&&safari.application.activeBrowserWindow)&&a.activeTab&&a.activeTab.page)&&a.dispatchMessage)return a;console.log("No dispatchMessage possible at this location!");console.trace();return{dispatchMessage:function(){}}},m=
function(){var a=[],b=0;return function(c){a=a.filter(function(a){return null!=a.browserWindow});void 0==c.id&&(c.id=b+1,b=c.id,a.push(c));return c.id}}();chrome={extension:{getBackgroundPage:function(){return safari.extension.globalPage.contentWindow},getURL:function(a){return safari.extension.baseURI+a},sendRequest:function(){var a=[];h?d("onRequest registration",function(b){b=f(b);-1==a.indexOf(b)&&a.push(b)}):a.push(f());return function(b,c){var e="callback"+Math.random();a.forEach(function(a){a.dispatchMessage("request",
{data:b,callbackToken:e})});var k=d("response",function(a){a.message.callbackToken==e&&(window.setTimeout(function(){var a=k;l().removeEventListener("message",a,!1)},0),c&&c(a.message.data))})}}(),onRequest:{addListener:function(a){h||f().dispatchMessage("onRequest registration",{});d("request",function(b){var c=b.message.data,e={};if(h){var k=m(b.target);e.tab={id:k,url:b.target.url}}a(c,e,function(a){a={callbackToken:b.message.callbackToken,data:a};f(b).dispatchMessage("response",a)})})}},connect:function(a){var b=
"portUuid"+Math.random(),c={name:a.name,uuid:b};f().dispatchMessage("port-create",c);return{name:a.name,onMessage:{addListener:function(a){d("port-postMessage",function(c){c.message.portUuid==b&&a(c.message.data)})}}}},onConnect:{addListener:function(a){d("port-create",function(b){var c=b.message.name,e=b.message.uuid,k=m(b.target);a({name:c,sender:{tab:{id:k,url:b.target.url}},onDisconnect:{addListener:function(){}},postMessage:function(a){f(b).dispatchMessage("port-postMessage",{portUuid:e,data:a})}})})}},
onRequestExternal:{addListener:function(){}}},i18n:function(){function a(a,b){var c=new XMLHttpRequest;c.open("GET",chrome.extension.getURL(a),!1);c.onreadystatechange=function(){4==this.readyState&&""!=this.responseText&&b(this.responseText)};try{c.send()}catch(g){}}function b(a,b){function c(a,b,e){a=a.replace(/\$\$/g,"~~~I18N~~:");a=a.replace(b,e);return a=a.replace(/~~~I18N~~:/g,"$$$$")}if(void 0==a.placeholders&&void 0==b)return a.message.replace(/\$\$/g,"$");var g=/\$([1-9])/g,f=function(a,
c){try{return b[c-1]}catch(e){return""}},d={},h;for(h in a.placeholders){var l=a.placeholders[h].content;d[h.toLowerCase()]=c(l,g,f)}g=c(a.message,g,f);g=c(g,/\$(\w+?)\$/g,function(a,c){var b=c.toLowerCase();return b in d?d[b]:a});return g=g.replace(/\$\$/g,"$")}var c=void 0;return{_getL10nData:function(){var b={locales:[]};b.locales.push(navigator.language.replace("-","_"));2<navigator.language.length&&b.locales.push(navigator.language.substring(0,2));-1==b.locales.indexOf("en")&&b.locales.push("en");
b.messages={};for(var c=0;c<b.locales.length;c++){var d=b.locales[c];a("_locales/"+d+"/messages.json",function(a){b.messages[d]=JSON.parse(a)})}return b},_setL10nData:function(a){c=a},getMessage:function(a,d){void 0==c&&chrome.i18n._setL10nData(chrome.i18n._getL10nData());"string"==typeof d&&(d=[d]);for(var f=0;f<c.locales.length;f++){var g=c.messages[c.locales[f]];if(g&&a in g)return b(g[a],d)}return""}}}()}}}();
