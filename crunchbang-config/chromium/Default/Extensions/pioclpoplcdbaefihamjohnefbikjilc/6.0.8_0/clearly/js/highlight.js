function initClearlyComponent__highlight(r){if(!r)return!1;$H=r;switch(!0){case !$H.settings:case !$H.settings.imgPath:case !$H.window:case !$H.document:case !$H.document.body:case !$H.jQuery:return $H.debug&&(console.log(!$H.settings),console.log(!$H.settings.imgPath),console.log(!$H.window),console.log(!$H.document),console.log(!$H.document.body),console.log(!$H.jQuery)),!1}$H.settings.elementWhichMustContainAllHighlights||($H.settings.elementWhichMustContainAllHighlights=$H.document.body);$H.settings.elementsToAttachMouseHandlersTo||
($H.settings.elementsToAttachMouseHandlersTo=[$H.document.body]);$H.settings.onInsertCSSUseThisId||($H.settings.onInsertCSSUseThisId="clearly_highlighting_css");$H.settings.highlightingEnabledCSSClass||($H.settings.highlightingEnabledCSSClass="clearly_highlighting_enabled");$H.settings.highlightElementIdAttribute||($H.settings.highlightElementIdAttribute="clearly_highlight_id");$H.settings.highlightElementCSSClass||($H.settings.highlightElementCSSClass="clearly_highlight_element");$H.settings.highlightElementFirstCSSClass||
($H.settings.highlightElementFirstCSSClass="clearly_highlight_first");$H.settings.highlightElementLastCSSClass||($H.settings.highlightElementLastCSSClass="clearly_highlight_last");$H.settings.highlightElementDeleteCSSClass||($H.settings.highlightElementDeleteCSSClass="clearly_highlight_delete_element");$H.settings.highlightElementDeleteIdPrefix||($H.settings.highlightElementDeleteIdPrefix="clearly_highlight_delete__");$H.settings.highlightCleanHTMLElementStart||($H.settings.highlightCleanHTMLElementStart=
'<span style="-evernote-highlighted:true; background-color:#f6ee96">');$H.settings.highlightCleanHTMLElementEnd||($H.settings.highlightCleanHTMLElementEnd="</span>");$=$H.jQuery;$H.$window=$($H.window);$H.$document=$($H.document);$H.$html=$H.$document.find("html");$H.$elementWhichMustContainAllHighlights=$($H.settings.elementWhichMustContainAllHighlights);$H.enabled=!1;$H.parseOptions={_elements_ignore:"|button|input|select|textarea|optgroup|command|datalist|--|frame|frameset|noframes|--|style|link|script|noscript|--|canvas|applet|map|--|marquee|area|base|",
_elements_ignore_tag:"|form|fieldset|details|dir|--|center|font|span|",_elements_container:"|body|--|article|section|--|div|--|td|--|li|--|dd|dt|",_elements_self_closing:"|br|hr|--|img|--|col|--|source|--|embed|param|--|iframe|",_elements_highlight_protect:"|video|audio|source|--|object|param|embed|",_elements_keep_attributes:{a:["href","title","name"],img:["src","width","height","alt","title"],video:"src width height poster audio preload autoplay loop controls".split(" "),audio:["src","preload",
"autoplay","loop","controls"],source:["src","type"],object:"data type width height classid codebase codetype".split(" "),param:["name","value"],embed:"src type width height flashvars allowscriptaccess allowfullscreen bgcolor".split(" "),iframe:["src","width","height","frameborder","scrolling"],td:["colspan","rowspan"],th:["colspan","rowspan"]}};$H.debug=$H.debug||!1;if($H.debug){switch(!0){case !(!$H.window.console||!$H.window.console.log):$H.writeLog=function(b){$H.window.console.log(b)};break;case !(!$H.window.opera||
!$H.window.opera.postError):$H.writeLog=function(b){$H.window.opera.postError(b)};break;default:$H.writeLog=function(b){}}$H.log=function(){if($H.debug){for(var b=0,a=arguments.length;b<a;b++)$H.writeLog(arguments[b]);$H.writeLog("-----------------------------------------")}}}else $H.writeLog=function(){return!1},$H.log=function(){return!1};$H.insertCSS=function(){var b="/* selection */ html."+$H.settings.highlightingEnabledCSSClass+" ::-moz-selection { background: rgba(246, 238, 150, 0.99); } html."+
$H.settings.highlightingEnabledCSSClass+" ::selection { background: rgba(246, 238, 150, 0.99); } /* cursor */ html."+$H.settings.highlightingEnabledCSSClass+' {    /* cursor and hot-spot position -- requires a default cursor, after the URL one */    cursor: url("'+$H.settings.imgPath+'highlight--cursor.png") 14 16, text; } /* highlight tag */ em.'+$H.settings.highlightElementCSSClass+' {    font-style: inherit !important; font-weight: inherit !important;    background-image: url("'+$H.settings.imgPath+
'highlight--yellow.png");    background-repeat: repeat-x; background-position: top left; background-size: 100% 100%; } /* the delete-buttons are positioned relative to this */ em.'+$H.settings.highlightElementCSSClass+"."+$H.settings.highlightElementFirstCSSClass+" { position: relative; } /* delete buttons */ em."+$H.settings.highlightElementCSSClass+" a."+$H.settings.highlightElementDeleteCSSClass+' {    display: none; cursor: pointer;    padding: 0; margin: 0; line-height: 0;    position: absolute; width: 34px; height: 34px; left: -17px; top: -17px;    background-image: url("'+
$H.settings.imgPath+'highlight--delete-sprite.png"); background-repeat: no-repeat; background-position: 0px 0px; } em.'+$H.settings.highlightElementCSSClass+" a."+$H.settings.highlightElementDeleteCSSClass+":hover { background-position: -34px 0px; } /* retina */ @media (min--moz-device-pixel-ratio: 2), (-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2) {    em."+$H.settings.highlightElementCSSClass+' { background-image: url("'+$H.settings.imgPath+'highlight--yellow@2x.png"); }    em.'+
$H.settings.highlightElementCSSClass+" a."+$H.settings.highlightElementDeleteCSSClass+' { background-image: url("'+$H.settings.imgPath+'highlight--delete-sprite@2x.png"); background-size: 68px 34px; } } ',a=$H.document.createElement("style");a.setAttribute("id",$H.settings.onInsertCSSUseThisId);a.setAttribute("type","text/css");a.styleSheet?a.styleSheet.cssText=b:a.appendChild($H.document.createTextNode(b));$H.$document.find("head").append(a)};$H.sel={};$H.sel.getWindowFromDocument=function(b){if(!b)return null;
arguments.calee="defaultView"in b?function(a){return a?a.defaultView:null}:"parentWindow"in b?function(a){return a?a.parentWindow:null}:function(a){return null};return arguments.calee(b)};$H.sel.getSelection=function(b){if(!b)return null;arguments.calee="getSelection"in b?function(a){return a?a.getSelection():null}:"selection"in b.document?function(a){return a?a.document.selection:null}:function(a){return null};return arguments.calee(b)};$H.sel.getRange=function(b){if(!b)return null;arguments.calee=
"getRangeAt"in b?function(a){return a?0<a.rangeCount?a.getRangeAt(0):null:null}:"createRange"in b?function(a){return a?a.createRange():null}:function(a){return null};return arguments.calee(b)};$H.sel.getRangeHTML=function(b){if(!b)return null;arguments.calee="htmlText"in b?function(a){return a?a.htmlText:null}:"surroundContents"in b?function(a){if(!a||!a.commonAncestorContainer||!a.commonAncestorContainer.ownerDocument)return null;var b=a.commonAncestorContainer.ownerDocument.createElement("div");
b.appendChild(a.cloneContents());return b.innerHTML}:function(a){return null};return arguments.calee(b)};$H.sel.getRangeText=function(b){if(!b)return null;arguments.calee="text"in b?function(a){return a?a.text:null}:"surroundContents"in b?function(a){if(!a||!a.commonAncestorContainer||!a.commonAncestorContainer.ownerDocument)return null;var b=a.commonAncestorContainer.ownerDocument.createElement("div");b.appendChild(a.cloneContents());return b.textContent}:function(a){return null};return arguments.calee(b)};
$H.rand=function(b,a){return Math.floor(Math.random()*(a-b+1))+b};$H.highlight__deleteSpansFromParents=function(b){for(var a=[],c=!1,c="",h=0,d=b.length;h<d;h++){for(var c=!1,f=0,l=a.length;f<l;f++)if(a[f]==b[h]){c=!0;break}c||(a.push(b[h]),c=b[h].innerHTML,-1<c.indexOf("<span")&&(c=c.replace(/<span([^>]*?)>/gi,""),c=c.replace(/<\/span>/gi,""),b[h].innerHTML=c))}};$H.highlight__getDeepestTextNode=function(b){for(var a=b;;)switch(!0){case a.nodeType&&3==a.nodeType:return a;case a.nodeType&&1==a.nodeType&&
0<a.childNodes.length:a=a.childNodes[0];break;case a.nodeType&&1==a.nodeType&&0==a.childNodes.length&&a.nextSibling:a=a.nextSibling;break;default:return b}};$H.highlight__getCommonAncestorContainerForNodes=function(b,a,c){for(var h=b,d=a;;){h=h.parentNode;d=d.parentNode;switch(!0){case !h:case !d:case h==c:case d==c:return c}switch(!0){case h==d:return h;case $.contains(h,a):return h;case $.contains(d,b):return d;case $.contains(h,d):return h;case $.contains(d,h):return d}}};$H.highlight__getParentElementOfNode=
function(b){for(;1!=b.nodeType;)b=b.parentNode;return b};$H.highlight__getParentElementOfNodeWithThisParent=function(b,a){switch(!0){case b==a:return b;case !$.contains(a,b):return b}for(var c=b;c.parentNode!=a;)c=c.parentNode;return c};$H.highlight__buildHTMLForElementWithSelectedRange=function(b,a,c){var h=0,d="",f="boundry-end"==a?!0:!1,l=function(b){h++;var g=3===b.nodeType?"#text":1===b.nodeType&&b.tagName&&""<b.tagName?b.tagName.toLowerCase():"#invalid",m=-1<$H.parseOptions._elements_ignore_tag.indexOf("|"+
g+"|"),m=m?"span"==g?!1:!0:!1,r=0,k=0,e=0,n=0,e="",p=n=!1;switch(!0){case "#invalid"==g:case -1<$H.parseOptions._elements_ignore.indexOf("|"+g+"|"):return;case "#text"==g:e=b.nodeValue.replace(/</gi,"&lt;").replace(/>/gi,"&gt;");switch(!0){case "everything"==a:e="<highlight>"+e+"</highlight>";break;case "boundry-start"==a:case "boundry-end"==a:case "boundry-both"==a:b==c.endContainer&&(e="<highlight>"+e.substr(0,c.endOffset)+"</highlight>"+e.substr(c.endOffset),f=!1,p=!0),b==c.startContainer&&(e=
""+e.substr(0,c.startOffset)+"<highlight>"+e.substr(c.startOffset)+"</highlight>",n=f=!0),n&&p&&(e=b.nodeValue.replace(/</gi,"&lt;").replace(/>/gi,"&gt;"),e=""+e.substr(0,c.startOffset)+"<highlight>"+e.substr(c.startOffset,c.endOffset-c.startOffset)+"</highlight>"+e.substr(c.endOffset),f=!1),n&&0<c.startOffset&&(e=e.replace(/([ .,;?!])([a-z0-9]{1,2})<highlight>/gi,"$1<highlight>$2"),e=e.replace(/<highlight>([\s])([^\s])/gi,"$1<highlight>$2"),e=e.replace(/<highlight>([a-z0-9])([ ])([a-z0-9])/gi,"$1$2<highlight>$3")),
p&&0<c.endOffset&&(g=!0,c.endContainer&&c.endContainer.nodeValue&&c.endContainer.nodeValue.length&&(g=c.endOffset<c.endContainer.nodeValue.length),g&&(e=e.replace(/<\/highlight>([a-z0-9]{0,2})([ .,;?!])/gi,"$1$2</highlight>"),e=e.replace(/([^\s])([\s])<\/highlight>/gi,"$1</highlight>$2"),e=e.replace(/([ ])([a-z0-9])<\/highlight>([a-z0-9])/gi,"</highlight>$1$2$3"))),n||p||(e=b.nodeValue.replace(/</gi,"&lt;").replace(/>/gi,"&gt;"),f&&(e="<highlight>"+e+"</highlight>"))}d+=e;return}1==c.endContainer.nodeType&&
b==c.endContainer&&(f=!1,p=!0);1==c.startContainer.nodeType&&b==c.startContainer&&(n=f=!0);n&&p&&(f=!1);if(!m){r=d.length;d+="<"+g;if(g in $H.parseOptions._elements_keep_attributes)for(e=0,n=$H.parseOptions._elements_keep_attributes[g].length;e<n;e++)k=$H.parseOptions._elements_keep_attributes[g][e],p=b.getAttribute(k),""<p&&(d+=" "+k+'="'+p+'"');k=b.getAttribute("id");""<k&&(d+=' id="'+k+'"');"a"==g&&(d+=' target="_blank"');k=b.getAttribute("class");""<k&&(d+=' class="'+k+'"');if("em"==g&&"everything"!=
a)switch(!0){case f:case 0==c.startOffset&&b.firstChild&&b.firstChild==c.startContainer:break;default:k=b.getAttribute($H.settings.highlightElementIdAttribute),""<k&&(d+=" "+$H.settings.highlightElementIdAttribute+'="'+k+'"')}d=-1<$H.parseOptions._elements_self_closing.indexOf("|"+g+"|")?d+" />":d+">";k=d.length}if(!(-1<$H.parseOptions._elements_self_closing.indexOf("|"+g+"|")))for(e=0,n=b.childNodes.length;e<n;e++)l(b.childNodes[e]);switch(!0){case m:return;case -1<$H.parseOptions._elements_self_closing.indexOf("|"+
g+"|"):n=e=d.length;break;default:e=d.length,d+="</"+g+">",n=d.length}switch(!0){case -1<$H.parseOptions._elements_highlight_protect.indexOf("|"+g+"|"):case "em"==g&&$(b).hasClass($H.settings.highlightElementCSSClass):d=""+d.substr(0,k)+d.substr(k,e-k).replace(/<highlight>/gi,"").replace(/<\/highlight>/gi,"")+d.substr(e);break;case "a"==g&&"deleteHighlight"==b.className:d=""+d.substr(0,r)+d.substr(n)}};l(b);return d=d.replace(/<highlight>/gi,'<em class="'+$H.settings.highlightElementCSSClass+'">').replace(/<\/highlight>/gi,
"</em>")};$H.highlight__doRange=function(b){var a=$H.highlight__getParentElementOfNode(b.commonAncestorContainer),c=$H.highlight__getParentElementOfNodeWithThisParent(b.startContainer,a),h=$H.highlight__getParentElementOfNodeWithThisParent(b.endContainer,a);if(a.tagName&&!$.contains($H.settings.elementWhichMustContainAllHighlights,a)||$H.callbacks.arbitraryRangeExclusion&&!1===$H.callbacks.arbitraryRangeExclusion(b,a,c,h))return!1;for(a=$H.rand(1,1E3);0<$H.$elementWhichMustContainAllHighlights.find("em."+
$H.settings.highlightElementCSSClass+"["+$H.settings.highlightElementIdAttribute+'="'+a+'"]').length;)a=$H.rand(1,1E3);for(var d=[],f=c,c=!1;;){c={_element:f,_tagName:3===f.nodeType?"#text":1===f.nodeType&&f.tagName&&""<f.tagName?f.tagName.toLowerCase():"#invalid"};d.push(c);if(f==h)break;f=f.nextSibling;if(!f)break}for(var h=[],c=0,l=d.length;c<l;c++){var f=d[c],q=f._element,f=f._tagName,g="",m=g=!1;switch(!0){case 1==l&&0==c:g="boundry-both";break;case 1<l&&0==c:g="boundry-start";break;case 1<l&&
c==l-1:g="boundry-end";break;default:g="everything"}g=$H.highlight__buildHTMLForElementWithSelectedRange(q,g,b);switch(!0){case "#text"==f:m=$H.document.createElement("span");m.innerHTML=g;q.parentNode.replaceChild(m,q);break;case -1<$H.parseOptions._elements_self_closing.indexOf("|"+f+"|"):m=q;break;default:m=q;g=g.substr(g.indexOf(">")+1);g=g.substr(0,g.lastIndexOf("<"));if(!(-1<g.indexOf('<em class="'+$H.settings.highlightElementCSSClass+'">')))break;q.innerHTML=g}$(m).find("em."+$H.settings.highlightElementCSSClass+
":not(["+$H.settings.highlightElementIdAttribute+"])").attr($H.settings.highlightElementIdAttribute,a);"em"==f&&$(m).hasClass($H.settings.highlightElementCSSClass)&&$(m).attr($H.settings.highlightElementIdAttribute,a);h.push(m.parentNode)}$H.highlight__deleteSpansFromParents(h)};$H.highlight__doCurentSelection=function(){var b=$H.sel.getSelection($H.window),a=$H.sel.getRange(b),c=$H.sel.getRangeText(a),a=a?{commonAncestorContainer:a.commonAncestorContainer,startContainer:a.startContainer,endContainer:a.endContainer,
startOffset:a.startOffset,endOffset:a.endOffset}:!1;switch(!0){case !c:case !(0<c.length):case !a:return!1}1==a.startContainer.nodeType&&a.startContainer.childNodes[a.startOffset]&&(a.startContainer=a.startContainer.childNodes[a.startOffset],a.startOffset=0);1==a.endContainer.nodeType&&a.endContainer.childNodes[a.endOffset]&&(a.endContainer=a.endContainer.childNodes[a.endOffset],a.endOffset=0);if(!1===$H.highlight__doRange(a))return!1;try{b.removeAllRanges()}catch(h){}var d=[];$H.$elementWhichMustContainAllHighlights.find("em."+
$H.settings.highlightElementCSSClass+" em."+$H.settings.highlightElementCSSClass).each(function(b,a){$(a).find("a."+$H.settings.highlightElementDeleteCSSClass).remove();var c=$H.document.createElement("span");c.innerHTML=a.innerHTML;a.parentNode.replaceChild(c,a);d.push(c.parentNode)});$H.highlight__deleteSpansFromParents(d);$H.$elementWhichMustContainAllHighlights.find("em."+$H.settings.highlightElementCSSClass+" a."+$H.settings.highlightElementDeleteCSSClass).remove();$H.$elementWhichMustContainAllHighlights.find("em."+
$H.settings.highlightElementCSSClass+"."+$H.settings.highlightElementFirstCSSClass).removeClass($H.settings.highlightElementFirstCSSClass);$H.$elementWhichMustContainAllHighlights.find("em."+$H.settings.highlightElementCSSClass+"."+$H.settings.highlightElementLastCSSClass).removeClass($H.settings.highlightElementLastCSSClass);var b=$H.$elementWhichMustContainAllHighlights.find("em."+$H.settings.highlightElementCSSClass),f=[],l=!1;b.each(function(a,b){f.push($(b).attr($H.settings.highlightElementIdAttribute))});
b.each(function(a,b){var c=f[a+1]?f[a]!=f[a+1]:!0;if(f[a-1]?f[a]!=f[a-1]:1)$(b).addClass($H.settings.highlightElementFirstCSSClass),l=$H.document.createElement("a"),l.className=$H.settings.highlightElementDeleteCSSClass,l.id=$H.settings.highlightElementDeleteIdPrefix+f[a],b.insertBefore(l,b.firstChild);c&&$(b).addClass($H.settings.highlightElementLastCSSClass)})};$H.highlight__deleteAllHighlights=function(){$H.highlight__deleteHighlight("all")};$H.highlight__deleteHighlight=function(b){var a=[];$H.$elementWhichMustContainAllHighlights.find("em."+
$H.settings.highlightElementCSSClass+("all"==b?"":"["+$H.settings.highlightElementIdAttribute+'="'+b+'"]')).each(function(b,h){var d=$H.document.createElement("span");d.innerHTML=h.innerHTML;h.parentNode.replaceChild(d,h);a.push(d.parentNode)});$H.highlight__deleteSpansFromParents(a)};$H.enable=function(){$H.enabled||($H.enabled=!0,$H.$html.addClass($H.settings.highlightingEnabledCSSClass))};$H.disable=function(){$H.enabled&&($H.enabled=!1,$H.$html.removeClass($H.settings.highlightingEnabledCSSClass))};
$H.highlight__mouseUp_timeout=!1;$H.highlight__deleteButton__byId__mouseEnter_timeout={};$H.highlight__deleteButton__byId__mouseLeave_timeout={};$H.highlight__mouseUp=function(){$H.enabled&&($H.highlight__mouseUp_timeout=$H.window.setTimeout(function(){$H.highlight__mouseUp_timeout=!1;!1!==$H.highlight__doCurentSelection()&&$H.callbacks.highlightAdded&&$H.callbacks.highlightAdded()},250))};$H.highlight__mouseDown=function(){$H.enabled&&$H.window.clearTimeout($H.highlight__mouseUp_timeout)};$H.highlight__deleteButton__show=
function(b){$H.$elementWhichMustContainAllHighlights.find("#"+$H.settings.highlightElementDeleteIdPrefix+b).fadeIn(250)};$H.highlight__deleteButton__hide=function(b){$H.$elementWhichMustContainAllHighlights.find("#"+$H.settings.highlightElementDeleteIdPrefix+b).fadeOut(250)};$H.addMouseHandlers=function(){for(var b=0,a=$H.settings.elementsToAttachMouseHandlersTo.length;b<a;b++)$($H.settings.elementsToAttachMouseHandlersTo[b]).mouseup($H.highlight__mouseUp).mousedown($H.highlight__mouseDown);$H.$elementWhichMustContainAllHighlights.on("mouseenter",
"em."+$H.settings.highlightElementCSSClass,function(){var a=$(this).attr($H.settings.highlightElementIdAttribute);$H.window.clearTimeout($H.highlight__deleteButton__byId__mouseLeave_timeout[a]);$H.highlight__deleteButton__byId__mouseEnter_timeout[a]=$H.window.setTimeout(function(){$H.highlight__deleteButton__byId__mouseEnter_timeout[a]=!1;$H.highlight__deleteButton__show(a)},250)});$H.$elementWhichMustContainAllHighlights.on("mouseleave","em."+$H.settings.highlightElementCSSClass,function(){var a=
$(this).attr($H.settings.highlightElementIdAttribute);$H.window.clearTimeout($H.highlight__deleteButton__byId__mouseEnter_timeout[a]);$H.highlight__deleteButton__byId__mouseLeave_timeout[a]=$H.window.setTimeout(function(){$H.highlight__deleteButton__byId__mouseLeave_timeout[a]=!1;$H.highlight__deleteButton__hide(a)},250)});$H.$elementWhichMustContainAllHighlights.on("click","em."+$H.settings.highlightElementCSSClass+" a."+$H.settings.highlightElementDeleteCSSClass,function(){var a=$(this.parentNode).attr($H.settings.highlightElementIdAttribute);
$(this).remove();$H.highlight__deleteHighlight(a);$H.callbacks.highlightDeleted&&$H.callbacks.highlightDeleted()})};$H.getCleanHTML=function(b){b=b.replace(/<span([^>]*?)>/gi,"");b=b.replace(/<\/span>/gi,"");b=b.replace(RegExp("<a ([^>]*?)"+$H.settings.highlightElementDeleteCSSClass+"([^>]*?)></a>","gi"),"");b=b.replace(RegExp("<em ([^>]*?)"+$H.settings.highlightElementCSSClass+"([^>]*?)>([^>]+?)</em>","gi"),"<highlight>$3</highlight>");for(var a=/<highlight>([\s\S]*?)<\/highlight>([ \n\r\t]*?)<highlight>([\s\S]*?)<\/highlight>/gi;b.match(a);)b=
b.replace(a,"<highlight>$1$3</highlight>");return b=b.replace(/<highlight>([\s\S]*?)<\/highlight>/gi,$H.settings.highlightCleanHTMLElementStart+"$1"+$H.settings.highlightCleanHTMLElementEnd)};return $H};
