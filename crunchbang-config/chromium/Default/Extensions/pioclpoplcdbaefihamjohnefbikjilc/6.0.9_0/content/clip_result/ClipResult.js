var NAME=CLIP_RESULT_NAME,pendingNoteKey,noteGuid,clipTitle="\u2026",currentStatus="contentclipper_clipping",type,notebookGuid,shareKey,linkedNotebookGuid,hour=8,minute=0,reminderOrder,client,baseUrl,china,userId,tokens,shardId,url,premium,userType,relatedNotesClicked={},totalNumRelatedNotes=0,numBizRelatedNotes=0,sameSiteNotesClicked={},totalNumSameSiteNotes=0,numBizSameSiteNotes=0,siteNotesRequested=!1,success=!1,successResponse,recordedRelatedResultsClick=siteNotesRequested=!1,recordedSameSiteClick=
!1,receivedRelatedNotes=!1,dateInputTimeout,main,icon,text,reminders,remindersSetter,addDateButton,tomorrow,nextWeek,dateInput,selectedMonth,selectedDate,selectedYear,selectedHour,selectedMinute,selectedMeridian,datePicker,editLink,notebook,relatedNotesButton,sameSiteNotesButton,tipsButton,close,smartPanel,errorTitle,errorDetails,errorButton,numEmailed,tipsContainer,rateNowButton,sendFeedbackButton,closeRatingsPromptButton,nearQuotaButton,referralTip,referralButton,skitchButton,iosFoodButton,androidFoodButton;
function addHandlers(){reminders.addEventListener("click",function(){if(/added/.test(reminders.className))datePicker.selectedDate()||(remindersSetter.className=remindersSetter.className.replace(/\s*hasDate/g,"")),datePicker.showTodayOrSelected();else{reminders.className+=" added";var a=tokens.authenticationToken;"biz"==type?a=tokens.bizAuthenticationToken:"linked"==type&&(a=tokens.linked);reminderOrder=Date.now();Browser.sendToExtension({name:"setReminder",auth:a,noteGuid:noteGuid,title:clipTitle,
sourceURL:url,reminderOrder:reminderOrder})}if(/visible/.test(remindersSetter.className)){if(remindersSetter.className=remindersSetter.className.replace(/\s*visible/g,""),reminders.className=reminders.className.replace(/\s*changingDate/g,""),a=document.querySelector("#date span.focused"))a.className=a.className.replace(/\s*focused/g,"")}else remindersSetter.className+=" visible",reminders.className+=" changingDate";port.postMessage({name:"setClipResultHeight",height:calcHeight()})});addDateButton.addEventListener("click",
function(){remindersSetter.className+=" hasDate";port.postMessage({name:"setClipResultHeight",height:calcHeight()})});tomorrow.addEventListener("click",function(){var a=new Date;a.setDate(a.getDate()+1);datePicker.selectDate(a)});nextWeek.addEventListener("click",function(){var a=new Date;a.setDate(a.getDate()+7);datePicker.selectDate(a)});remindersSetter.addEventListener("click",function(a){!dateInput.contains(a.srcElement)&&(a=document.querySelector("#date span.focused"))&&(a.className=a.className.replace(/\s*focused/g,
""))});remindersSetter.addEventListener("webkitTransitionEnd",function(a){if("width"==a.propertyName&&!/hasDate/.test(remindersSetter.className)&&remindersSetter.scrollHeight>remindersSetter.clientHeight)for(a=0;a<document.styleSheets.length;a++)if(/clip_result\.css/.test(document.styleSheets[a].href)){for(var b=0;b<document.styleSheets[a].cssRules.length;b++)if("#remindersSetter"==document.styleSheets[a].cssRules[b].selectorText){document.styleSheets[a].cssRules[b].style.height=53+remindersSetter.scrollHeight-
remindersSetter.clientHeight+"px";break}break}});editLink.addEventListener("click",doNoteSuccessAction);for(var a=document.querySelectorAll("#tabs .tab"),b=0;b<a.length;b++)a.item(b).addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"});selectSmartSection.call(this)});close.addEventListener("click",dismiss);errorButton.addEventListener("click",handleErrorClick);rateNowButton.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"});
Browser.sendToExtension({name:"trackEvent",category:"ratingsPrompt",action:"rate now clickthru",label:userType,userId:userId});Browser.sendToExtension({name:"setPersistentValue",key:userId+"_sawRatingsPrompt",value:!0})});sendFeedbackButton.addEventListener("click",openFeedbackForm);closeRatingsPromptButton.addEventListener("click",closeRatingsPrompt);nearQuotaButton.addEventListener("click",handleErrorClick);referralButton.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"});
Browser.sendToExtension({name:"trackEvent",category:"Referral",action:"promo clickthru",label:userType,userId:userId});Browser.sendToExtension({name:"setPersistentValue",key:userId+"_sawReferralCount",value:5})});skitchButton.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"});Browser.sendToExtension({name:"trackEvent",action:"skitch",category:"cross promo clickthru",label:userType,userId:userId})});iosFoodButton.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"});
Browser.sendToExtension({name:"trackEvent",action:"ios food",category:"cross promo clickthru",label:userType,userId:userId})});androidFoodButton.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"});Browser.sendToExtension({name:"trackEvent",action:"android food",category:"cross promo clickthru",label:userType,userId:userId})})}
function buildSiteQuery(){for(var a=url.replace(/^.*?:\/\/(.*?)\/.*$/,"$1").replace(/^(www\.)?(.*)/i,"$2"),b="any:",c=["http://","https://","http://www.","https://www."],d=0;d<c.length;d++)b+=" sourceUrl:"+c[d]+a+"*";return b}function calcHeight(){var a=0;/visible/.test(remindersSetter.className)&&(a=/hasDate/.test(remindersSetter.className)?395:133);return a>main.offsetHeight?a:main.offsetHeight}
function closeRatingsPrompt(){Browser.sendToExtension({name:"main_recordActivity"});Browser.sendToExtension({name:"trackEvent",category:"ratingsPrompt",action:"close ratings prompt clickthru",label:userType,userId:userId});Browser.sendToExtension({name:"setPersistentValue",key:userId+"_sawRatingsPrompt",value:!0});tipsButton.style.display="none";"none"==relatedNotesButton.style.display?document.body.className+=" noSmart":selectSmartSection.call(relatedNotesButton)}
function dismiss(){port.postMessage({name:"hideClipResult"})}function doneSharing(a,b,c){"evernote"==a.shareType&&(document.querySelector("#evernote").innerText="Copied!")}
function doNoteSuccessAction(){Browser.sendToExtension({name:"main_recordActivity"});var a=GlobalUtils.getNoteURI(client,baseUrl,{shardId:shardId,shareKey:shareKey,noteGuid:noteGuid,inBusinessNotebook:"biz"==type,notebookGuid:notebookGuid,linkedNotebookGuid:linkedNotebookGuid},"edit",userId,0,{pers:tokens.authenticationToken,biz:tokens.bizAuthenticationToken});"WEB"==client?Browser.sendToExtension({name:"main_openWindow",width:800,height:600,url:a}):"DESKTOP"==client&&GlobalUtils.openDesktopLink(a)}
function handleDateTimeKeydown(a){var b=document.querySelector("#date span.focused");if(b){clearTimeout(dateInputTimeout);var c=parseInt(selectedYear.innerText||selectedYear.textContent),d=parseInt(selectedMonth.innerText||selectedMonth.textContent)-1,e=parseInt(selectedDate.innerText||selectedDate.textContent);if("Up"==a.keyIdentifier)b===selectedYear?datePicker.selectDate(new Date(c+1,d,e),"year"):b===selectedMonth?datePicker.selectDate(new Date(c,d+1,e),"month"):b===selectedDate?datePicker.selectDate(new Date(c,
d,e+1),"date"):b===selectedHour?(hour=(hour+1)%24,datePicker.selectDate(new Date(c,d,e),"hour")):b===selectedMinute?(minute=(minute+1)%60,datePicker.selectDate(new Date(c,d,e),"minute")):b===selectedMeridian&&(hour=(hour+12)%24,datePicker.selectDate(new Date(c,d,e),"meridian"));else if("Right"==a.keyIdentifier)b.nextElementSibling&&b.nextElementSibling.click();else if("Down"==a.keyIdentifier)b===selectedYear?datePicker.selectDate(new Date(c-1,d,e),"year"):b===selectedMonth?datePicker.selectDate(new Date(c,
d-1,e),"month"):b===selectedDate?datePicker.selectDate(new Date(c,d,e-1),"date"):b===selectedHour?(hour=(hour-1+24)%24,datePicker.selectDate(new Date(c,d,e),"hour")):b===selectedMinute?(minute=(minute-1+60)%60,datePicker.selectDate(new Date(c,d,e),"minute")):b===selectedMeridian&&(hour=(hour-12+24)%24,datePicker.selectDate(new Date(c,d,e),"meridian"));else if("Left"==a.keyIdentifier)b.previousElementSibling&&b.previousElementSibling.click();else if(48<=a.keyCode&&57>=a.keyCode||96<=a.keyCode&&105>=
a.keyCode){var f=a.keyCode%48;57<a.keyCode&&(f=a.keyCode%96);b===selectedYear?3>selectedYear.innerText.length?(selectedYear.innerText+=f,dateInputTimeout=setTimeout(function(){datePicker.selectDate(new Date(parseInt(selectedYear.innerText||selectedYear.textContent),d,e))},500)):3==selectedYear.innerText.length?(selectedYear.innerText+=f,datePicker.selectDate(new Date(parseInt(selectedYear.innerText||selectedYear.textContent),d,e))):(selectedYear.innerText=f,dateInputTimeout=setTimeout(function(){datePicker.selectDate(new Date(parseInt(selectedYear.innerText||
selectedYear.textContent),d,e))},500)):b===selectedMonth?2>selectedMonth.innerText.length?-1==d?(selectedMonth.innerText=f,datePicker.selectDate(new Date(c,f-1,e))):3>f?(selectedMonth.innerText+=f,datePicker.selectDate(new Date(c,parseInt(selectedMonth.innerText||selectedMonth.textContent)-1,e))):dateInputTimeout=setTimeout(function(){datePicker.selectDate(new Date(c,d,e))},500):(selectedMonth.innerText=f,1<f?datePicker.selectDate(new Date(c,f-1,e)):dateInputTimeout=setTimeout(function(){var a=parseInt(selectedMonth.innerText||
selectedMonth.textContent)-1,a=0>a?d:a;datePicker.selectDate(new Date(c,a,e))},500)):b===selectedDate?2>selectedDate.innerText.length?2>e?(selectedDate.innerText+=f,datePicker.selectDate(new Date(c,d,parseInt(selectedDate.innerText||selectedDate.textContent)))):(new Date(c,d,10*e+f)).getDate()==10*e+f?(selectedDate.innerText+=f,datePicker.selectDate(new Date(c,d,parseInt(selectedDate.innerText||selectedDate.textContent)))):dateInputTimeout=setTimeout(function(){datePicker.selectDate(new Date(c,d,
e))},500):(selectedDate.innerText=f,3<f?datePicker.selectDate(new Date(c,d,parseInt(selectedDate.innerText||selectedDate.textContent))):dateInputTimeout=setTimeout(function(){datePicker.selectDate(new Date(c,d,parseInt(selectedDate.innerText||selectedDate.textContent)))},500)):b===selectedHour?2>selectedHour.innerText.length?(a=parseInt(selectedHour.innerText),0==a?(hour=f,datePicker.selectDate(new Date(c,d,e))):1==a&&(3>f?(hour=10+f,datePicker.selectDate(new Date(c,d,e))):dateInputTimeout=setTimeout(function(){hour=
1;datePicker.selectDate(new Date(c,d,e))},500))):2>f?(selectedHour.innerText=f,dateInputTimeout=setTimeout(function(){0!=f&&(hour=f);datePicker.selectDate(new Date(c,d,e))},500)):(hour=f,datePicker.selectDate(new Date(c,d,e))):b===selectedMinute&&(2>selectedMinute.innerText.length?(a=parseInt(selectedMinute.innerText),minute=10*a+f,datePicker.selectDate(new Date(c,d,e))):6>f?(selectedMinute.innerText=f,dateInputTimeout=setTimeout(function(){0!=f&&(minute=f);datePicker.selectDate(new Date(c,d,e))},
500)):(minute=f,datePicker.selectDate(new Date(c,d,e))))}else if((65==a.keyCode||80==a.keyCode)&&b===selectedMeridian){if("AM"==selectedMeridian.innerText&&80==a.keyCode||"PM"==selectedMeridian.innerText&&65==a.keyCode)hour=(hour+12)%24;datePicker.selectDate(new Date(c,d,e))}}}
function handleErrorClick(){if(/upgradable/.test(this.className)){var a="clipper-chrome";SAFARI?a="clipper-safari":OPERA?a="clipper-opera":YANDEX&&(a="clipper-yandex");var b;/overQuota/.test(this.className)?b=premium?baseUrl+"/SetAuthToken.action?auth="+encodeURIComponent(tokens.authenticationToken)+"&targetUrl="+encodeURIComponent("/QuotaCheckout.action?origin="+a+"&offer=overQuota"):baseUrl+"/SetAuthToken.action?auth="+encodeURIComponent(tokens.authenticationToken)+"&targetUrl="+encodeURIComponent("/Checkout.action?origin="+
a+"&offer=overQuota"):/noteSizeExceeded/.test(this.className)?b=baseUrl+"/SetAuthToken.action?auth="+encodeURIComponent(tokens.authenticationToken)+"&targetUrl="+encodeURIComponent("/Checkout.action?origin="+a+"&offer=maxNoteSize"):/nearQuota/.test(this.className)&&(b=premium?baseUrl+"/SetAuthToken.action?auth="+encodeURIComponent(tokens.authenticationToken)+"&targetUrl="+encodeURIComponent("/QuotaCheckout.action?origin="+a+"&offer=nearQuota"):baseUrl+"/SetAuthToken.action?auth="+encodeURIComponent(tokens.authenticationToken)+
"&targetUrl="+encodeURIComponent("/Checkout.action?origin="+a+"&offer=nearQuota"));Browser.sendToExtension({name:"main_openWindow",width:800,height:600,url:b})}else dismiss()}
function handleFailure(a,b,c){document.body.className="error";errorTitle.innerText=Browser.i18n.getMessage("cannotSaveClip");switch(a.error){case "overQuota":premium?(errorDetails.innerText=Browser.i18n.getMessage("notification_quotaExceededPremium"),errorButton.innerText=Browser.i18n.getMessage("getMoreSpacePremium")):(errorDetails.innerText=Browser.i18n.getMessage("notification_quotaExceededFree"),errorButton.innerText=Browser.i18n.getMessage("upgradeToPremium"));errorButton.className+=" upgradable overQuota";
break;case "noteSizeExceeded":premium?(errorDetails.innerText=Browser.i18n.getMessage("noteSizeExceededPremium"),errorButton.className=errorButton.className.replace(/\s*upgradable/g,""),errorButton.innerText=Browser.i18n.getMessage("ok")):(errorDetails.innerText=Browser.i18n.getMessage("noteSizeExceededFree"),errorButton.className+=" upgradable noteSizeExceeded",errorButton.innerText=Browser.i18n.getMessage("upgradeToPremium"))}port.postMessage({name:"setClipResultHeight",height:calcHeight()})}
function handleRelatedNotesClick(){Browser.sendToExtension({name:"main_recordActivity"});document.querySelector("#slider").className=document.querySelector("#slider").className.replace(/show\w+/g,"")+" showLeft";var a=document.querySelector("#siteSearchButton").className;document.querySelector("#siteSearchButton").className=a.replace(/(^|\s+)selected($|\s+)/,"");document.querySelector("#relatedNotesButton").className="selected"}
function handleSuccess(a,b,c){success=!0;if(receivedRelatedNotes){document.body.className+=" done";setStatusTitle("desktopNotification_clipUploaded");if(a.notebookName){notebook.innerText=a.notebookName;var d=window.getComputedStyle(notebook);b=main.offsetWidth-4;c=editLink.offsetLeft+editLink.offsetWidth;d=parseInt(d.marginLeft)+parseInt(d.paddingLeft)+parseInt(d.marginRight);notebook.style.maxWidth=b-c-d+"px"}noteGuid=a.noteGuid;shardId=a.shardId;if(addDateButton.scrollWidth>addDateButton.clientWidth||
remindersSetter.scrollHeight>remindersSetter.clientHeight)for(b=0;b<document.styleSheets.length;b++)if(/clip_result\.css/.test(document.styleSheets[b].href)){for(c=0;c<document.styleSheets[b].cssRules.length;c++)if("#remindersSetter"==document.styleSheets[b].cssRules[c].selectorText){addDateButton.scrollWidth>addDateButton.clientWidth?document.styleSheets[b].cssRules[c].style.width=112+addDateButton.scrollWidth-addDateButton.clientWidth+"px":remindersSetter.scrollHeight>remindersSetter.clientHeight&&
(document.styleSheets[b].cssRules[c].style.height=53+remindersSetter.scrollHeight-remindersSetter.clientHeight+"px");break}break}b=a.uploaded;c=a.savedAuthInfo;d=a.shownNearQuotaUpsell;a.showRatings?(tipsContainer.className+=" ratings",selectSmartSection.call(tipsButton),Browser.sendToExtension({name:"trackEvent",category:"ratingsPrompt",action:"prompt shown",label:userType,userId:userId}),Browser.sendToExtension({name:"setPersistentValue",key:userId+"_successfulClipsCount",value:0})):b&&b[userId]&&
c&&c.userInfo&&c.userInfo[userId]&&c.userInfo[userId].quota&&(!d||!d[userId])&&0.75<(b[userId]+a.noteSize)/c.userInfo[userId].quota?(d||(d={}),d[userId]=!0,Browser.sendToExtension({name:"setPersistentValue",key:"shownNearQuotaUpsell",value:d}),tipsContainer.className+=" nearQuota",premium?(document.querySelector("#nearQuotaTip .tipDetails").innerText=Browser.i18n.getMessage("nearQuotaPremium"),nearQuotaButton.innerText=Browser.i18n.getMessage("getMoreSpacePremium")):(document.querySelector("#nearQuotaTip .tipDetails").innerText=
Browser.i18n.getMessage("nearQuotaFree"),nearQuotaButton.innerText=Browser.i18n.getMessage("upgradeToPremium")),selectSmartSection.call(tipsButton)):a.showReferral?(tipsContainer.className+=" referral",selectSmartSection.call(tipsButton),Browser.sendToExtension({name:"trackEvent",category:"Referral",action:"promo shown",label:userType,userId:userId}),Browser.sendToExtension({name:"getPersistentValue",key:userId+"_sawReferralCount"}),Browser.sendToExtension({name:"setPersistentValue",key:userId+"_clipsCount_referral",
value:0})):a.skitch?(tipsContainer.className+=" skitch",selectSmartSection.call(tipsButton),Browser.sendToExtension({name:"trackEvent",action:"skitch",category:"cross promo shown",label:userType,userId:userId})):a.recipe?(tipsContainer.className+=" food",selectSmartSection.call(tipsButton),Browser.sendToExtension({name:"trackEvent",action:"food",category:"cross promo shown",label:userType,userId:userId})):tipsButton.style.display="none";"none"==relatedNotesButton.style.display&&"none"==tipsButton.style.display&&
(document.body.className+=" noSmart");sameSiteNotesButton.style.maxWidth=tabs.offsetWidth-24-relatedNotesButton.offsetWidth-tipsButton.offsetWidth+"px";port.postMessage({name:"setClipResultHeight",height:calcHeight()})}else successResponse=a}
function msgHandlerReceiveClipResultInfo(a,b,c){setStatusTitle(null,a.title);type=a.type;notebookGuid=a.notebookGuid;shareKey=a.shareKey;if("linked"==type||"biz"==type)linkedNotebookGuid=a.linkedNotebookGuid?a.linkedNotebookGuid:notebookGuid;url=a.url;client=a.client;baseUrl=a.baseUrl;skitchButton.href=baseUrl+"/skitch";if(china=/china/i.test(a.locale))tipsContainer.className+=" china";userId=a.userId;tokens=a.auth;premium=a.premium;userType="free";userType=tokens.bizAuthenticationToken?"business":
"premium";referralButton.href=baseUrl+"/SetAuthToken.action?auth="+encodeURIComponent(tokens.authenticationToken)+"&targetUrl="+encodeURIComponent("/referfriend?utm_source=web_clipper&utm_medium=in_app");sameSiteNotesButton.innerText=Browser.i18n.getMessage("clipsFromThisSite",url.replace(/^https?:\/\/(.*?)\/.*/,"$1"));port.postMessage({name:"setClipResultHeight",height:calcHeight()});Browser.sendToExtension({name:"getRelatedNotes",pendingNoteKey:pendingNoteKey,tokens:tokens,userId:userId})}
function msgHandlerReceivePersistentValue(a,b,c){a.key===userId+"_sawReferralCount"&&((a=a.value)||(a=0),Browser.sendToExtension({name:"setPersistentValue",key:userId+"_sawReferralCount",value:++a}))}
function openFeedbackForm(){Browser.sendToExtension({name:"main_recordActivity"});Browser.sendToExtension({name:"trackEvent",category:"ratingsPrompt",action:"open feedback form clickthru",label:userType,userId:userId});Browser.sendToExtension({name:"setPersistentValue",key:userId+"_sawRatingsPrompt",value:!0});port.postMessage({name:"showFeedbackForm"});dismiss()}
function receiveRelatedNotes(a,b,c){receivedRelatedNotes=!0;b=new NoteSnippets(document.querySelector("#relatedNotesContainer"),baseUrl,userId,null,client,{pers:tokens.authenticationToken,biz:tokens.bizAuthenticationToken},null,!1,function(a,b){relatedNotesClicked[a]=b?2:1});b.setNotes(a.relatedNotes);b.hasAtLeastOneNotebookName()&&(smartPanel.className+=" hasAtLeastOneNotebookName");if(a.relatedNotes&&0<a.relatedNotes.length){totalNumRelatedNotes+=a.relatedNotes.length;for(b=0;b<a.relatedNotes.length;b++)a.relatedNotes[b].inBusinessNotebook&&
numBizRelatedNotes++;selectSmartSection.call(relatedNotesButton);port.postMessage({name:"setClipResultHeight",height:calcHeight()})}else recordedRelatedResultsClick=!0,relatedNotesButton.style.display="none";success&&handleSuccess(successResponse)}
function receiveSameSiteNotes(a,b,c){if(a.notesSize)for("linked"!=type&&success&&(a.notes.list.shift(),a.totalNotes--),(new NoteSnippets(document.querySelector("#sameSiteNotesContainer"),baseUrl,userId,null,client,{pers:tokens.authenticationToken,biz:tokens.bizAuthenticationToken},buildSiteQuery(),!1,function(a,b){sameSiteNotesClicked[a]=b?2:1})).setNotes(a.notes.list,a.totalNotes),totalNumSameSiteNotes+=a.notes.list.length,b=0;b<a.notes.list.length;b++)a.notes.list[b].inBusinessNotebook&&numBizSameSiteNotes++;
else recordedSameSiteClick=!0}
function recordAnalytics(){if(!recordedRelatedResultsClick&&(recordedRelatedResultsClick=!0,Browser.sendToExtension({name:"trackEvent",userId:userId,category:"Post UX",action:"general related notes clickthru",label:userType,value:100*Object.keys(relatedNotesClicked).length/totalNumRelatedNotes}),"business"==userType&&0<numBizRelatedNotes)){var a=0,b;for(b in relatedNotesClicked)2==relatedNotesClicked[b]&&a++;Browser.sendToExtension({name:"trackEvent",userId:userId,category:"Post UX",action:"business related notes clickthru",
label:userType,value:100*a/Object.keys(relatedNotesClicked).length})}if(!recordedSameSiteClick&&(recordedSameSiteClick=!0,Browser.sendToExtension({name:"trackEvent",userId:userId,category:"Post UX",action:"general same site notes clickthru",label:userType,value:100*Object.keys(sameSiteNotesClicked).length/totalNumSameSiteNotes}),"business"==userType&&0<numBizSameSiteNotes)){a=0;for(b in sameSiteNotesClicked)2==sameSiteNotesClicked[b]&&a++;Browser.sendToExtension({name:"trackEvent",userId:userId,category:"Post UX",
action:"business same site notes clickthru",label:userType,value:100*a/Object.keys(sameSiteNotesClicked).length})}}function selectDateTimePart(){var a=document.querySelector("#date span.focused");a&&(a.className=a.className.replace(/\s*focused/g,""));this.className+=" focused"}
function selectSmartSection(){var a=document.querySelector(".tab.pressed");a&&(a.className=a.className.replace(/\s*pressed/g,""));this.className+=" pressed";smartPanel.className=smartPanel.className.replace(/\s*(relatedNotes|sameSiteNotes|tips)/g,"")+" "+this.id;"sameSiteNotes"!=this.id||siteNotesRequested||(Browser.sendToExtension({name:"main_performNoteSearch",resultSpec:{includeTitle:!0,includeUpdated:!0,includeAttributes:!0,includeLargestResourceMime:!0,includeLargestResourceSize:!0,includeNotebookGuid:!0,
includeUpdateSequenceNum:!0},noteFilter:{order:2,words:buildSiteQuery()}}),siteNotesRequested=!0)}
function setReminderTime(a,b){var c=new Date(a.year,a.month,a.date,hour,minute,0,0);dateInput.innerHTML=datePicker.format(c);selectedMonth=document.querySelector("#selectedMonth");selectedDate=document.querySelector("#selectedDate");selectedYear=document.querySelector("#selectedYear");selectedHour=document.querySelector("#selectedHour");selectedMinute=document.querySelector("#selectedMinute");selectedMeridian=document.querySelector("#selectedMeridian");selectedMonth.addEventListener("click",selectDateTimePart);
selectedDate.addEventListener("click",selectDateTimePart);selectedYear.addEventListener("click",selectDateTimePart);selectedHour.addEventListener("click",selectDateTimePart);selectedMinute.addEventListener("click",selectDateTimePart);selectedMeridian.addEventListener("click",selectDateTimePart);if(b)switch(b){case "year":selectedYear.click();break;case "month":selectedMonth.click();break;case "date":selectedDate.click();break;case "hour":selectedHour.click();break;case "minute":selectedMinute.click();
break;case "meridian":selectedMeridian.click()}return c}function setStatusTitle(a,b){a&&(currentStatus=a);b&&(clipTitle=b);text.innerHTML=Browser.i18n.getMessage(currentStatus,[clipTitle])}function showSyncing(){setStatusTitle("contentclipper_syncing")}
window.addEventListener("DOMContentLoaded",function(){SAFARI&&(document.body.className+=" safari");main=document.querySelector("#main");icon=document.querySelector("#icon");text=document.querySelector("#text");reminders=document.querySelector("#reminders");remindersSetter=document.querySelector("#remindersSetter");addDateButton=document.querySelector("#addDate");tomorrow=document.querySelector("#tomorrow");nextWeek=document.querySelector("#nextWeek");dateInput=document.querySelector("#date");datePicker=
new DatePicker(document.querySelector("#datePicker"),function(a,c){var d=setReminderTime(a,c),e=tokens.authenticationToken;"biz"==type?e=tokens.bizAuthenticationToken:"linked"==type&&(e=tokens.linked);Browser.sendToExtension({name:"setReminder",auth:e,noteGuid:noteGuid,title:clipTitle,sourceURL:url,reminderOrder:reminderOrder,reminderTime:d-0})});editLink=document.querySelector("#edit");notebook=document.getElementById("notebook");close=document.querySelector("#close");smartPanel=document.querySelector("#smartPanel");
document.querySelector("#tabs");relatedNotesButton=document.querySelector("#relatedNotes");sameSiteNotesButton=document.querySelector("#sameSiteNotes");tipsButton=document.querySelector("#tips");errorTitle=document.querySelector("#errorTitle");errorDetails=document.querySelector("#errorDetails");errorButton=document.querySelector("#errorButton");tipsContainer=document.querySelector("#tipsContainer");rateNowButton=document.querySelector("#rateNow");sendFeedbackButton=document.querySelector("#sendFeedback");
closeRatingsPromptButton=document.querySelector("#closeRatingsPrompt");nearQuotaButton=document.querySelector("#nearQuotaTip .tipButton");referralTip=document.querySelector("#referralTip");referralButton=document.querySelector("#referralCTA");skitchButton=document.querySelector("#skitchTip .tipButton");iosFoodButton=document.querySelector("#iosFood");androidFoodButton=document.querySelector("#androidFood");GlobalUtils.localize(document.body);var a=new Date;setReminderTime({year:a.getFullYear(),month:a.getMonth(),
date:a.getDate()});pendingNoteKey=/#(.+)/.exec(window.location.hash)[1];addHandlers();startSecretGeneration()});
window.addEventListener("click",function(a){if(!remindersSetter.contains(a.srcElement)&&!reminders.contains(a.srcElement)){remindersSetter.className=remindersSetter.className.replace(/\s*visible/g,"");reminders.className=reminders.className.replace(/\s*changingDate/g,"");if(a=document.querySelector("#date span.focused"))a.className=a.className.replace(/\s*focused/g,"");port.postMessage({name:"setClipResultHeight",height:calcHeight()})}});window.addEventListener("keydown",handleDateTimeKeydown);
window.addEventListener("beforeunload",recordAnalytics);window.addEventListener("unload",recordAnalytics);Browser.addMessageHandlers({doneSharing:doneSharing,handleFailure:handleFailure,handleSuccess:handleSuccess,sameSiteNotes:receiveSameSiteNotes,receiveClipResultInfo:msgHandlerReceiveClipResultInfo,receivePersistentValue:msgHandlerReceivePersistentValue,relatedNotes:receiveRelatedNotes,showSyncing:showSyncing});document.addEventListener("keyup",function(a){a&&a.keyCode&&27==a.keyCode&&dismiss()});
