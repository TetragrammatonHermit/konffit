function LogViewer(){function f(a){if(a.length){for(var b=0;b<a.length;b++)c.push(a[b]);m.readEntries(f,n)}else p(),g()}function n(){log.error("Error reading log directory.");p();g()}function p(){for(var a=0,a=0;a<c.length;a++){var b=document.createElement("option");b.value=c[a].name;b.textContent=c[a].name;document.getElementById(h).appendChild(b)}document.getElementById(h).selectedIndex=a-1}function g(){var a=document.getElementById(h).selectedIndex;-1!=a&&c[a].file(v,q)}function v(a){var b=new FileReader;
b.onloadend=w;b.readAsText(a)}function q(){log.error("readLogFailed.");k=!1}function w(a){a=document.createElement("pre");a.textContent=this.result;document.getElementById(r).innerHTML="";document.getElementById(r).appendChild(a);document.getElementById(s).checked&&scroll(0,document.body.offsetHeight)}function t(){if(c.length)if(e==c.length){var a=document.createElement("a");a.href=window.webkitURL.createObjectURL(new Blob([d]));a.download="evernote_web_clipper_logs.txt";a.click();d="";e=0;k=!1}else d+=
c[e].name+"\n",c[e].file(x,q)}function x(a){var b=new FileReader;b.onloadend=y;b.readAsText(a)}function y(a){d+=this.result+"\n\n";e++;t()}var u,m,h="logSelector",s="logFollow",r="logViewer";GlobalUtils.localize(document.body);GlobalUtils.localize(document.getElementsByTagName("title")[0]);var c=[],e=0,d="",k=!1;webkitRequestFileSystem(PERSISTENT,Log.maxLogSize,function(a){u=a;m=u.root.createReader();m.readEntries(f,n)},function(a){log.error("Failed to init FileSystem.");enabled=!1});var l=0;document.getElementById(h).addEventListener("change",
g);document.getElementById(s).addEventListener("change",function(){l&&(clearInterval(l),l=0);this.checked&&(l=setInterval(g,2E3))});document.getElementById("exportButton").addEventListener("click",function(){k||(k=!0,t())});Object.preventExtensions(this)}Object.preventExtensions(LogViewer);window.addEventListener("error",function(f){log.error(JSON.stringify(f))});var logViewer=null;document.addEventListener("DOMContentLoaded",function(){logViewer=new LogViewer});
