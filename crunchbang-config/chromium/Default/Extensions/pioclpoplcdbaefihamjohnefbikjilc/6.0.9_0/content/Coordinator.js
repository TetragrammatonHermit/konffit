function Coordinator(){function ea(a){20<=window.innerWidth-a?(a=window.innerWidth-20,l.className=l.className.replace(/\s*evernoteClipperVisible/g,""),f.port1.postMessage({name:"hideFilingDialogHacks",height:l.offsetHeight-12}),fa(),r.className=r.className.replace(/\s*evernoteClipperVisible/g,""),f.port1.postMessage({name:"hideUserToolsHacks"})):a=window.innerWidth;k.setSize(a,window.innerHeight);k.center()}function Y(){k&&(k.getElement().parentNode.removeChild(k.getElement()),k.destroy(),document.body.style.overflow=
"",b&&(b.contentDocument.body.style.overflow=""));k=null;C={};document.body.className=document.body.className.replace(/\s*skitchon/g,"")}function Ea(){/skitchon/.test(document.body.className)&&Z?(D(),f.port1.postMessage({name:"postCrop",fromKeyboard:!0}),Z=!1):/evernoteClipperVisible/.test(l.className)?ga():m&&/evernoteClipperVisible/.test(m.className)?oa():/evernoteClipperVisible/.test(e.className)&&P()}function pa(a){/evernoteClipperVisible/.test(e.className)&&!/skitchon/.test(document.body.className)&&
ga({data:{focus:a}})}function aa(a){/evernoteClipperVisible/.test(e.className)&&!/skitchon/.test(document.body.className)&&("expand"==a?contentPreview.expandPreview():"contract"==a?contentPreview.contractPreview():"up"==a?contentPreview.moveToElementAbove():"down"==a&&contentPreview.moveToElementBelow())}function qa(a,g){if(Q&&h[a])h[a](g)}function E(a){if(!a||a.constructor!==MouseEvent||/evernoteClipperVisible/.test(e.className))fa(),l.className=l.className.replace(/\s*evernoteClipperVisible/g,""),
ra(),r.className=r.className.replace(/\s*evernoteClipperVisible/g,""),f.port1.postMessage({name:"hideFilingDialogHacks"}),f.port1.postMessage({name:"hideUserToolsHacks"}),window.focus()}function F(a){if(b){var g=b.scrollWidth;n.$iframeBox[0].style.display="none";b.contentDocument.querySelector("#loading").style.display="none";b.contentDocument.documentElement.className=b.contentDocument.documentElement.className.replace(/\s*clearlyVisible/g,"");document.body.className=document.body.className.replace(/\s*clearlyVisible/g,
"");document.documentElement.className=document.documentElement.className.replace(/\s*clearlyVisible/g,"");document.body.scrollLeft=sa;document.body.scrollTop=ta;n.$iframeBackground.animate({right:g+"px"},500,"clearlyEasingForBackground",function(){document.body.className=document.body.className.replace(/\s*clearlyBeforeVisible/g,"");document.documentElement.className=document.documentElement.className.replace(/\s*clearlyBeforeVisible/g,"");b.style.setProperty("top","-100%","important");b.style.setProperty("left",
"-100%","important");b.style.setProperty("height",document.body.clientHeight+"px","important");a&&("previewArticle"==a?contentPreview.previewArticle():"previewFullPage"==a?contentPreview.previewFullPage():"previewUrl"==a?contentPreview.previewUrl():"previewEmail"==a?contentPreview.previewEmail():"previewSelection"==a&&contentPreview.previewSelection())})}else a&&("previewArticle"==a?contentPreview.previewArticle():"previewFullPage"==a?contentPreview.previewFullPage():"previewUrl"==a?contentPreview.previewUrl():
"previewEmail"==a?contentPreview.previewEmail():"previewSelection"==a&&contentPreview.previewSelection())}function G(a,g){a&&a.for&&"screenshot"==a.for&&(R=!0,ha=a.tool,ua=a.showSubtools,S=a.contextMenu,/evernoteClipperVisible/.test(l.className)||(T=!0),!S||/evernoteClipperVisible/.test(e.className)||/evernoteClipperVisible/.test(l.className)||(U.play(),Browser.sendToExtension({name:"captureScreenshot",contextMenu:S})));f.port1.postMessage({name:"hideExtras"});e.className=e.className.replace(/\s*evernoteClipperVisible/g,
"");!g&&m&&(m.className=m.className.replace(/\s*evernoteClipperVisible/g,""));E()}function ra(){t.className=t.className.replace(/\s*evernoteClipperVisible/g,"");t.blur()}function oa(){m.className=m.className.replace(/\s*evernoteClipperVisible/g,"");D();f.port1.postMessage({name:"reactivateClipperTool"})}function fa(){p.className=p.className.replace(/\s*evernoteClipperVisible/g,"");f.port1.postMessage({name:"hideShareDialogHacks",height:p.offsetHeight-12})}function va(){k&&k.disableEvents();document.body.className=
document.body.className.replace(/\s*skitchon/g,"");e.className=e.className.replace(/\s*(tempHidden|hidable)/g,"");document.body.style.overflow="";b&&(b.contentDocument.body.style.overflow="")}function Fa(){z=document.createElement("div");z.id="evernoteLoading";document.body.appendChild(z);document.documentElement.appendChild(l);document.documentElement.appendChild(r);document.documentElement.appendChild(p);document.documentElement.appendChild(t);document.documentElement.appendChild(e);window.addEventListener("keydown",
function(a){/evernoteClipperVisible/.test(e.className)&&(/Mac OS X/.test(window.navigator.userAgent)?a.metaKey&&a.preventDefault():/Windows/.test(window.navigator.userAgent)&&a.ctrlKey&&a.preventDefault(),-1<[8,13,27,39,37,65,70,66,83,77,80,69,67].indexOf(a.keyCode)&&(/skitchon/.test(document.body.className)||a.preventDefault()))});window.addEventListener("keypress",function(a){if(/skitchon/.test(document.body.className)&&!document.querySelector("textarea.skitch-tool-element-text-editor")){var g=
k.getElement().offsetWidth/2,c=k.getElement().offsetHeight/2;u("text",null,{x:g,y:c},a.charCode);a.preventDefault()}});window.addEventListener("click",E);window.addEventListener("mousedown",function(a){/evernoteClipperVisible/.test(e.className)?contentPreview.isPointOnVeil(a.pageX,a.pageY)&&a.preventDefault():m&&/evernoteClipperVisible/.test(m.className)&&a.preventDefault()});window.addEventListener("resize",function(){/skitchon/.test(document.body.className)&&ea(k.getBox().width);wa(parseInt(l.style.height))});
window.addEventListener("unload",function(){Browser.sendToExtension({name:"showLoggedInOrOutState"});if(!H&&b){var a=b.getAttribute("maxScrollY")||"0";Browser.sendToExtension({name:"trackEvent",userId:q,category:"Clearly",action:"scroll",label:s,value:100*parseInt(a)/(b.contentWindow.document.body.scrollHeight-b.contentWindow.innerHeight)});H=!0;I||(I=!0,Browser.sendToExtension({name:"trackEvent",userId:q,category:"Clearly",action:"didn't save",label:s}))}});Browser.sendToExtension({name:"getKeyboardShortcuts",
shortcuts:"closeWebClipperShortcut previewArticleShortcut previewFullPageShortcut previewUrlShortcut selectionModeShortcut takeScreenshotShortcut clearlyShortcut pdfShortcut emailShortcut expandArticleShortcut contractArticleShortcut moveArticleUpShortcut moveArticleDownShortcut selectNotebookShortcut addTagsShortcut saveShortcut arrowShortcut textShortcut rectangleShortcut roundedRectangleShortcut ellipseShortcut lineShortcut markerShortcut highlighterShortcut stampShortcut pixelateShortcut cropShortcut".split(" ")});
V++}function P(a,g,c){4!==V?(J=[a,g,c],Fa()):(z&&z.parentNode&&z.parentNode.removeChild(z),ia=!(!a||!a.dontStartPreview),/evernoteClipperVisible/.test(e.className)||a.contextMenu||"screenshot"==a.for?(G({for:a?a.for:null,contextMenu:a?a.contextMenu:null}),Browser.sendToExtension({name:"showLoggedInState"}),contentPreview.clear(),contentPreview.reset(),w=x=null,f.port1.postMessage({name:"stopSkitch"}),Y(),K=0,b&&(H||(H=!0,a=b.getAttribute("maxScrollY")||"0",Browser.sendToExtension({name:"trackEvent",
userId:q,category:"Clearly",action:"scroll",label:s,value:100*parseInt(a)/(b.contentWindow.document.body.scrollHeight-b.contentWindow.innerHeight)})),I||(I=!0,Browser.sendToExtension({name:"trackEvent",userId:q,category:"Clearly",action:"saved",label:s}))),F()):(clipResultCoordinator.hideClipResult(!1),D(a),Browser.sendToExtension({name:"showOpenState"})))}function ja(){V++;0<J.length&&4===V&&(P(J[0],J[1],J[2]),J=[]);window.focus()}function Ga(){/evernoteClipperVisible/.test(e.className)&&f.port1.postMessage({name:"save"})}
function wa(a){l.style.setProperty("height",a+"px","important");f.port1.postMessage({name:"getFilingTop"})}function xa(){n.applyUnencodedOptions(n.defaultThemes.newsprint);n.loadGoogleFontsRequiredByAppliedOptions();var a=b.scrollWidth;document.body.className+=" clearlyBeforeVisible";document.documentElement.className+=" clearlyBeforeVisible";n.$iframeBox[0].style.display="none";n.$iframeBackground[0].style.right=a+"px";sa=document.body.scrollLeft;ta=document.body.scrollTop;b.style.setProperty("top",
"0px","important");b.style.setProperty("left","0px","important");b.style.setProperty("height",document.body.scrollHeight+"px","important");n.$iframeBackground.animate({right:"0px"},500,"clearlyEasingForBackground",function(){b.contentDocument.querySelector("#loading").style.display="block";document.body.className+=" clearlyVisible";document.documentElement.className+=" clearlyVisible";b.contentDocument.documentElement.className+=" clearlyVisible";ia||f.port1.postMessage({name:"makeHidable"});window.focus();
0==n.pagesCount?pageInfo.getCleanArticle(function(a){if(a&&0<a.length){n.addNewPage(a[0],window.location.href);ka();for(var c=1;c<a.length;c++)n.addNewPage(a[c],window.location.href);a=Math.max(document.body.scrollHeight,b.contentDocument.body.scrollHeight);b.style.setProperty("height",a+"px","important")}else pageInfo.getDefaultArticle(function(a){a&&(n.addNewPage(a.outerHTML,window.location.href),ka())})},function(a,c){n.addNewPage(a,c);var d=Math.max(document.body.scrollHeight,b.contentDocument.body.scrollHeight);
b.style.setProperty("height",d+"px","important")}):ka()})}function ka(){n.$iframeBox[0].style.display="block";b.contentDocument.querySelector("#loading").style.display="none";window.scrollTo(0,0);var a=Math.max(document.body.scrollHeight,b.contentDocument.body.scrollHeight);b.style.setProperty("height",a+"px","important");Browser.sendToExtension({name:"bounce",message:{name:"taskFinished",type:"clearly"}})}function D(a){a&&(Browser.sendToExtension({name:"main_recordActivity"}),v.port1.postMessage({name:"reset"}),
L.port1.postMessage({name:"reset"}),f.port1.postMessage({name:"reset"}),ya=a.username,q=a.userId,W=a.authTokens,ba=a.premium,s="free",W.biz?s="business":ba&&(s="premium"),v.port1.postMessage({name:"initialize",alwaysTags:a.alwaysTags,gmailThread:pageInfo.isGmailThread(),title:document.title.trim(),url:pageInfo.getCanonicalUrl()||document.location.href,userId:q,userType:s}),la||(la=!0,v.port1.postMessage({name:"setKeyboardHandlers",handlers:A,keyboardShortcutsEnabled:Q})),Browser.sendToExtension({name:"getSmartFilingInfo",
authTokens:W,query:pageInfo.getSearchQuery(),recText:pageInfo.getRecommendationText(!1),userId:q}),Browser.sendToExtension({name:"getNotebooks",authTokens:W,userId:q,username:ya}),Browser.sendToExtension({name:"getTags",authTokens:W,userId:q}),f.port1.postMessage({name:"setUsername",fullName:a.fullName}),f.port1.postMessage({name:"setPossibleClipTypes",pageInfo:{pdf:pageInfo.getPdfUrl(),documentIsFrameset:pageInfo.documentIsFrameset,selection:pageInfo.getSelection()?!0:!1,gmail:pageInfo.isGmail(),
gmailThread:pageInfo.isGmailThread()}}),e.className+=" needToLoadRest",L.port1.postMessage({name:"setup",auth:a.authTokens.pers,baseUrl:a.baseUrl,currentUser:a.fullName,premium:ba}),r.className=ba?r.className+" evernoteClipperPremium":r.className.replace(/\s*evernoteClipperPremium/g,""));e.className=e.className.replace(/\s*tempHidden/g,"");e.className+=" evernoteClipperVisible";R=!1}function Ha(){n={callbacks:{frameCreated:function(){b=n.iframe;b.contentWindow.addEventListener("scroll",function(){var a=
b.contentWindow.scrollY;a>ma&&(ma=a,b.contentWindow.frameElement.setAttribute("maxScrollY",ma))});var a=b.contentDocument.createElement("div"),g=b.contentDocument.createElement("div");a.setAttribute("id","loading");g.setAttribute("id","loading_spinner");a.appendChild(g);b.contentDocument.body.appendChild(a);a=b.contentDocument.createElement("style");a.setAttribute("id","loading_sign_css");a.setAttribute("type","text/css");g="#loading { position: fixed; top: 0; right: 0; width: 100%; height: 100%; z-index: 300; ";
g=1.5>window.devicePixelRatio?g+("background-image: url('"+Browser.extension.getURL("clearly/images/loading--background.png")+"'); "):g+("background-image: url('"+Browser.extension.getURL("clearly/images/loading--background@2x.png")+"'); ");g+="background-position: center center; background-repeat: no-repeat; } #loading_spinner { position: absolute; top: 0; left: 0; width: 100%; height: 100%; ";g=1.5>window.devicePixelRatio?g+("background-image: url('"+Browser.extension.getURL("clearly/images/loading--big.gif")+
"'); "):g+("background-image: url('"+Browser.extension.getURL("clearly/images/loading--big@2x.gif")+"'); ");a.innerText=g+"background-position: center center; background-repeat: no-repeat; }";b.contentDocument.body.appendChild(a);b.contentWindow.ClearlyComponent__highlight={callbacks:{},settings:{imgPath:Browser.extension.getURL("clearly/images/")},window:b.contentWindow,document:b.contentDocument,jQuery:window.jQuery};b.contentWindow.ClearlyComponent__highlight=initClearlyComponent__highlight(b.contentWindow.ClearlyComponent__highlight);
b.contentWindow.ClearlyComponent__highlight.insertCSS();b.contentWindow.ClearlyComponent__highlight.addMouseHandlers();xa()}},settings:{cssPath:Browser.extension.getURL("clearly/css/"),pageLabel:Browser.i18n.getMessage("page")+" ",onCreateFrameUseThisId:"evernoteClearlyArticle",onCreateFrameDoNotInsertCSS:!0},window:window,jQuery:window.jQuery};n=initClearlyComponent__reformat(n);$.easing.clearlyEasingForBackground=function(a,g,c,d,b){a=(g/=b)*g;b=a*g;return c+d*(-2.5*b*a+10*a*a-14*b+7*a+0.5*g)};
n.createFrame()}function za(a){function g(c,g){var b={name:"receiveNoteContent",clipType:a.data.type,html:c,pendingNoteKey:X,recommendationText:pageInfo.getRecommendationText(!1),share:a.data.share,hasTextHighlights:0<K,userId:q,userType:s,width:g};x&&(b.updateGuid=x);w&&(b.previousToken=w);Browser.sendToExtension(b);a.data.share||(contentPreview.reset(),K=0,w=x=null)}function c(){v.port1.postMessage({name:"sendFilingInfo",pendingNoteKey:X,useDefaultNotebook:a.data.contextMenu});"screenshot"==a.data.type?
(a.data.contextMenu||k.getFile(function(c){c={name:"receiveNoteContent",clipType:"skitch",content:'<img src="resource:0"></img>',contentClass:"evernote.skitch",pendingNoteKey:X,recommendationText:pageInfo.getRecommendationText(!1),resources:[{bytes:c.bytes,mime:c.mime}],share:a.data.share,userId:q,userType:s};x&&(c.updateGuid=x);w&&(c.previousToken=w);Browser.sendToExtension(c);for(var b in C)Browser.sendToExtension({name:"trackEvent",userId:q,category:"Skitch Tool",action:b,label:s,value:C[b]})}),
a.data.share||(contentPreview.reset(),K=0,w=x=null,Y())):"clearly"==a.data.type?(clipper.clipClearly(n.$iframePages[0],b.contentWindow,function(a,c){g(a,c)}),a.data.share||F(),I=!0,Browser.sendToExtension({name:"trackEvent",userId:q,category:"Clearly",action:"saved",label:s})):("article"==a.data.type?clipper.clipArticle(!0,g):"fullPage"==a.data.type?clipper.clipFullPage(!0,g):"selection"==a.data.type?clipper.clipSelection(!0,a.data.selectionText,g):"url"==a.data.type?clipper.clipUrl(g):"pdf"==a.data.type?
clipper.clipPdf(g):"email"==a.data.type?clipper.clipEmail(g):"image"==a.data.type&&clipper.clipImage(a.data.imageUrl,g),a.data.share||(contentPreview.clear(),Y()));a.data.contextMenu&&f.port1.postMessage({name:"stopSkitch"})}if(ia)p.className+=" evernoteClipperVisible";else{X=UUID.generateGuid();if(a.data.share)E(),p.className+=" evernoteClipperVisible",c();else if(G(),Browser.sendToExtension({name:"showLoggedInState"}),clipResultCoordinator.showClipResult(X,c),b&&!H){H=!0;var d=b.getAttribute("maxScrollY")||
"0";Browser.sendToExtension({name:"trackEvent",userId:q,category:"Clearly",action:"scroll",label:s,value:100*parseInt(d)/(b.contentWindow.document.body.scrollHeight-b.contentWindow.innerHeight)})}b&&"clearly"!=a.data.type&&(I=!0,Browser.sendToExtension({name:"trackEvent",userId:q,category:"Clearly",action:"didn't save",label:s}))}}function y(a,b){/evernoteClipperVisible/.test(e.className)&&!/skitchon/.test(document.body.className)&&(a?f.port1.postMessage({name:"switchMode",mode:a}):b&&f.port1.postMessage({name:"switchMode",
direction:b}))}function u(a,b,c,d){/skitchon/.test(document.body.className)&&f.port1.postMessage({name:"switchSkitchTool",tool:a,subtool:b,location:c,charCode:d})}function Aa(a){if(/evernoteClipperVisible/.test(a.className))return a.className=a.className.replace(/\s*evernoteClipperVisible/g,""),!1;E();a.className+=" evernoteClipperVisible";return!0}function ga(a){a&&a.data&&(na=a.data.focus);Aa(l)?f.port1.postMessage({name:"showFilingDialogHacks",focus:na,height:l.offsetHeight-12,top:l.offsetTop+
2}):f.port1.postMessage({name:"hideFilingDialogHacks"})}function Ia(a){a&&(-1<["INPUT","TEXTAREA"].indexOf(a.nodeName)||"true"===a.contentEditable)||Browser.sendToExtension({name:"toggleClipper"},function(){alert("The Clipper couldn't start on this page. Reload the page and try again. If that doesn't help, contact customer support.")})}function Ba(){/clearlyVisible/.test(document.documentElement.className)?b.contentWindow.ClearlyComponent__highlight.disable():B.disable()}function Ca(a){k.enableEvents();
document.body.className+=" skitchon";document.body.style.overflow="hidden";window.scrollTo(0,0);k.useTool(a.data.tool);"crop"==a.data.tool?(Z=!0,G(),f.port1.postMessage({name:"unmakeHidable"})):"text"==a.data.tool&&a.data.location&&k.startActiveTool(a.data.location,{value:String.fromCharCode(a.data.charCode),selectOnFocus:!1});Ba()}function Da(a){"toggleFilingTools"==a.data.name?ga(a):-1<["setNotebook","createTag"].indexOf(a.data.name)&&f.port1.postMessage(a.data)}function Ja(a){if("receiveFilingTop"==
a.data.name)l.style.setProperty("top",Math.min(window.innerHeight-parseInt(l.style.height)-20,a.data.top)+"px","important"),/evernoteClipperVisible/.test(l.className)&&f.port1.postMessage({name:"showFilingDialogHacks",height:l.offsetHeight-12,top:l.offsetTop+2});else if("startSubmission"==a.data.name)za(a);else if("toggleCoordinator"==a.data.name)P(a.data);else if("useSkitchTool"==a.data.name)Ca(a);else if("useSkitchColor"==a.data.name)k.updateSelectedElementsColor(a.data.color),k.useColor(a.data.color);
else if("setToolbarWidth"==a.data.name)e.style.setProperty("width",a.data.width,"important");else if("dispatchEvent"==a.data.name){var g=a.data.type,c=a.data.x,d=a.data.y;a=document.createEvent("MouseEvents");c=window.innerWidth-c;d=window.innerHeight-d;a.initMouseEvent(g,!0,!0,window,1,null,null,c,d,!1,!1,!1,!1,1,null);document.querySelector(".skitch-layer-tool").dispatchEvent(a)}else"hideSkitch"==a.data.name?va():a.data.name==GLOBAL_TOOLS_NAME+"Ready"?ja():"showClearly"==a.data.name?b?xa():Ha():
"hideClearly"==a.data.name?F(a.data.after):"toggleUserTools"==a.data.name?Aa(r)?f.port1.postMessage({name:"showUserToolsHacks",height:parseFloat(window.getComputedStyle(r).height)}):f.port1.postMessage({name:"hideUserToolsHacks"}):"zoomin"==a.data.name?/skitchon/.test(document.body.className)&&(k.zoom(1.1,{x:window.innerWidth/2,y:window.innerHeight/2}),ea(k.getBox().width)):"zoomout"==a.data.name?/skitchon/.test(document.body.className)&&(k.zoom(1/1.1,{x:window.innerWidth/2,y:window.innerHeight/2}),
ea(k.getBox().width)):"hideAllTools"==a.data.name?(E(),clipResultCoordinator.hideClipResult(!0)):"useHighlighter"==a.data.name?/skitchon/.test(document.body.className)?Ca({data:{tool:"highlighter"}}):/clearlyVisible/.test(document.documentElement.className)?b.contentWindow.ClearlyComponent__highlight.enable():B.enable():"turnOffHTMLHighlighter"==a.data.name?Ba():"tempHideGlobalTools"==a.data.name?e.className+=" tempHidden":"untempHideGlobalTools"==a.data.name?e.className=e.className.replace(/\s*tempHidden/g,
""):"makeGlobalToolsHidable"==a.data.name&&(e.className+=" hidable",e.style.removeProperty("width"))}function Ka(a){"setFilingToolsHeight"==a.data.name?wa(a.data.height):-1<["clearTag","clearTags"].indexOf(a.data.name)?f.port1.postMessage(a.data):a.data.name==FILING_TOOLS_NAME+"Ready"&&ja()}function La(a){"setOptionsHeight"==a.data.name?a.data.height>window.innerHeight?(m.style.setProperty("height",window.innerHeight+"px","important"),m.style.setProperty("top","-webkit-calc(50% - "+window.innerHeight/
2+"px)","important"),M.port1.postMessage({name:"setPinchHeight",totalHeight:window.innerHeight})):(m.style.setProperty("height",a.data.height+"px","important"),m.style.setProperty("top","-webkit-calc(50% - "+a.data.height/2+"px)","important")):"hideOptions"==a.data.name&&oa()}function Ma(a){"showOptions"==a.data.name?(m&&m.parentNode&&m.parentNode.removeChild(m),M=new MessageChannel,M.port1.addEventListener("message",La),M.port1.start(),m=document.createElement("iframe"),m.id="evernoteOptionsPage",
m.addEventListener("load",function(){M.port1.postMessage({name:"setKeyboardHandlers",handlers:N})}),document.documentElement.appendChild(m),m.src=Browser.extension.getURL("options.html#iframe"),m.className="evernoteClipperVisible",G(null,!0),va(),F(),contentPreview.gray()):a.data.name==USER_TOOLS_NAME+"Ready"&&ja()}function Na(a){"hideEmailDialog"==a.data.name&&(p.className+=" evernoteClipperVisible",ra(),f.port1.postMessage({name:"showShareDialogHacks",height:p.offsetHeight-12}))}function Oa(a){"showEmailDialog"==
a.data.name?(a=a.data,E(),t.className+=" evernoteClipperVisible",O.port1.postMessage({name:"setup",auth:a.auth,noteGuid:a.noteGuid,persAuth:a.persAuth,sharedAuth:a.sharedAuth,subject:a.subject,userId:a.userId,userType:a.userType}),f.port1.postMessage({name:"showShareDialogHacks",height:t.offsetHeight-12})):"setShareToolsHeight"==a.data.name?(p.style.setProperty("height",a.data.height+"px","important"),/evernoteClipperVisible/.test(p.className)&&f.port1.postMessage({name:"showShareDialogHacks",height:p.offsetHeight-
12})):"hideShareTools"==a.data.name&&fa()}var e,l,m,b,r,t,p,z,f,v,M,L,O,ca,k,C={},Z=!1,U,ma=0,sa=0,ta=0,B,n,ya,q,W,ba,s,Q=!0,h={},A={},N={},X,K=0,V=0,R=!1,ha,ua=!1,S=!1,na=null,T=!1,da=!1,H=!1,I=!1,ia=!1,la=!1,J=[],x=null,w=null;this.msgHandlerToggleCoordinator=P;Browser.addMessageHandlers({doneSharing:function(a,b,c){x=a.guid;w=a.token},finishContextMenuScreenshot:function(a,b,c){R=!1},hideCoordinator:G,hideScrollbar:function(a,g,c){document.body.style.overflow="hidden";b&&(b.contentDocument.body.style.overflow=
"hidden")},logoutCallback:function(a,b,c){G();contentPreview.clear();f.port1.postMessage({name:"stopSkitch"});Y();F()},receiveKeyboardShortcuts:function(a,b,c){Q=a.keyboardShortcutsEnabled;b={};for(var d in a.keys){var f=[],f=a.keys[d].split("|");c=f.join(" + ");b[c]=qa;"startWebClipperShortcut"==d?h[c]=Ia:"closeWebClipperShortcut"==d?(h[c]=Ea,A[d]=[c],N[d]=[c]):"previewArticleShortcut"==d?h[c]=function(){y("article")}:"previewFullPageShortcut"==d?h[c]=function(){y("fullPage")}:"previewUrlShortcut"==
d?h[c]=function(){y("url")}:"selectionModeShortcut"==d?h[c]=function(){y("selection")}:"takeScreenshotShortcut"==d?h[c]=function(){y("screenshot")}:"clearlyShortcut"==d?h[c]=function(){y("clearly")}:"pdfShortcut"==d?h[c]=function(){y("pdf")}:"emailShortcut"==d?h[c]=function(){y("email")}:"expandArticleShortcut"==d?h[c]=function(){aa("expand")}:"contractArticleShortcut"==d?h[c]=function(){aa("contract")}:"moveArticleUpShortcut"==d?h[c]=function(){aa("up")}:"moveArticleDownShortcut"==d?h[c]=function(){aa("down")}:
"selectNotebookShortcut"==d?h[c]=function(){pa("notebook")}:"addTagsShortcut"==d?h[c]=function(){pa("tags")}:"saveShortcut"==d?h[c]=Ga:"arrowShortcut"==d?h[c]=function(){u("shape","arrow")}:"textShortcut"==d?h[c]=function(){u("text")}:"rectangleShortcut"==d?h[c]=function(){u("shape","rectangle")}:"roundedRectangleShortcut"==d?h[c]=function(){u("shape","roundedRectangle")}:"ellipseShortcut"==d?h[c]=function(){u("shape","ellipse")}:"lineShortcut"==d?h[c]=function(){u("shape","line")}:"markerShortcut"==
d?h[c]=function(){u("marker")}:"highlighterShortcut"==d?h[c]=function(){u("highlighter")}:"stampShortcut"==d?h[c]=function(){u("stamp")}:"pixelateShortcut"==d?h[c]=function(){u("pixelate")}:"cropShortcut"==d&&(h[c]=function(){u("crop")});if(-1<f.indexOf("91")){var e=JSON.parse(JSON.stringify(f));/windows/i.test(window.navigator.userAgent)?(e[f.indexOf("91")]="17",e.sort(function(a,b){return a-b}),h[e.join(" + ")]=h[c],delete h[c],b[e.join(" + ")]=b[c],delete b[c],A[d]&&(A[d][0]=e.join(" + ")),N[d]&&
(N[d][0]=e.join(" + "))):(e[f.indexOf("91")]="93",e.sort(function(a,b){return a-b}),h[e.join(" + ")]=h[c],b[e.join(" + ")]=b[c],A[d]&&A[d].push(e.join(" + ")),N[d]&&N[d].push(e.join(" + ")))}}Browser.addKeyboardHandlers(b);4===V&&(la=!0,v.port1.postMessage({name:"setKeyboardHandlers",handlers:A,keyboardShortcutsEnabled:Q}))},receiveKeyboardShortcutsEnabled:function(a,b,c){Q=a.keyboardShortcutsEnabled},receiveScreenshot:function(a,b,c){k=Skitch.createSurface({width:window.innerWidth,allowZoom:!1,height:window.innerHeight,
url:a.url,top:0,left:0,margin:0,success:function(){document.body.appendChild(k.getElement());window.screenshotDone&&window.screenshotDone();k.getElement().addEventListener("mousedown",function(){f.port1.postMessage({name:"closeSubtools"});e.style.removeProperty("width")});k.useTool(a.tool);k.enableEvents();document.body.className+=" skitchon";f.port1.postMessage({name:"makeHidable"});window.scrollTo(0,0);contentPreview.clear();F();k.toast(Browser.i18n.getMessage("screenshotToast"));D()}});k.on("toolStarted",
function(a){C[a]||(C[a]=0);C[a]++});k.on("toolStopped",function(a){"crop"==a&&(Z=!1,D(),f.port1.postMessage({name:"postCrop"}))});k.localize({CROP_APPLY_TEXT:Browser.i18n.getMessage("apply"),CROP_CANCEL_TEXT:Browser.i18n.getMessage("regForm_cancel"),ZOOM_RESET_TEXT:Browser.i18n.getMessage("reset"),ZOOM_TIP_TEXT:Browser.i18n.getMessage("panInstruction")})},receiveSecret:function(a,b,c){a.for===GLOBAL_TOOLS_NAME?e.contentWindow.postMessage({name:"receivePort",secret:a.secret},Browser.extension.getURL(""),
[f.port2]):a.for===FILING_TOOLS_NAME?l.contentWindow.postMessage({name:"receivePort",secret:a.secret},Browser.extension.getURL(""),[v.port2]):a.for===OPTIONS_PAGE_NAME?m.contentWindow.postMessage({name:"receivePort",secret:a.secret},Browser.extension.getURL(""),[M.port2]):a.for===USER_TOOLS_NAME?r.contentWindow.postMessage({name:"receivePort",secret:a.secret},Browser.extension.getURL(""),[L.port2]):a.for===EMAIL_SHARING_NAME?t.contentWindow.postMessage({name:"receivePort",secret:a.secret},Browser.extension.getURL(""),
[O.port2]):a.for===SHARE_TOOLS_NAME&&p.contentWindow.postMessage({name:"receivePort",secret:a.secret},Browser.extension.getURL(""),[ca.port2])},showCoordinator:D,startSubmission:function(a,b,c){za({data:a})},toggleCoordinator:P,updateKeyboardShortcut:function(a,b,c){"string"===typeof a.oldShortcut&&(a.oldShortcut=[a.oldShortcut],a.shortcut=[a.shortcut]);for(b=0;b<a.oldShortcut.length;b++){var d=a.oldShortcut[b].split("|").join(" + ");c=a.shortcut[b].split("|").join(" + ");h[c]=h[d];delete h[d];d=
{};d[c]=qa;Browser.addKeyboardHandlers(d)}},pauseSkitch:function(){/skitchon/.test(document.body.className)&&f.port1.postMessage({name:"stopSkitch"})}});window.addEventListener("message",function(a){RegExp(a.origin,"i").test(Browser.extension.getURL(""))&&("eventFilter"==a.data.name||"eventClick"==a.data.name?"globalTools"===a.data.wnd&&f.port1.postMessage(a.data):-1<["setNotebook","createTag"].indexOf(a.data.name)&&f.port1.postMessage(a.data))});Browser.sendToExtension({name:"getKeyboardShortcuts",
shortcuts:["startWebClipperShortcut"]});(function(){v=new MessageChannel;v.port1.addEventListener("message",Ka);v.port1.addEventListener("message",Da);v.port1.start();l=document.createElement("iframe");l.id="evernoteFilingTools";l.addEventListener("webkitTransitionEnd",function(){R?(T=!0,da&&(U.play(),Browser.sendToExtension({name:"captureScreenshot",tool:ha,contextMenu:S}),da=T=!1)):/evernoteClipperVisible/.test(l.className)&&(l.focus(),v.port1.postMessage({name:"setFocus",focus:na}))});L=new MessageChannel;
L.port1.addEventListener("message",Ma);L.port1.start();r=document.createElement("iframe");r.id="evernoteUserTools";ca=new MessageChannel;ca.port1.addEventListener("message",Oa);ca.port1.start();p=document.createElement("iframe");p.id="evernoteShareTools";O=new MessageChannel;O.port1.addEventListener("message",Na);O.port1.start();t=document.createElement("iframe");t.id="evernoteEmailSharing";t.addEventListener("webkitTransitionEnd",function(){/evernoteClipperVisible/.test(t.className)&&O.port1.postMessage({name:"focusRecipients"})});
f=new MessageChannel;f.port1.addEventListener("message",Ja);f.port1.addEventListener("message",Da);f.port1.addEventListener("message",contentPreview.onMessage);f.port1.start();e=document.createElement("iframe");e.id="evernoteGlobalTools";e.addEventListener("webkitTransitionEnd",function(){R&&(da=!0,T&&(U.play(),Browser.sendToExtension({name:"captureScreenshot",tool:ha,showSubtools:ua,contextMenu:S}),da=T=!1));/needToLoadRest/.test(e.className)&&(e.className=e.className.replace(/\s*needToLoadRest/g,
""),Browser.sendToExtension({name:"getOption",option:"defaultClipAction"}))});l.src=Browser.extension.getURL("content/filing_tools/filing_tools.html");r.src=Browser.extension.getURL("content/user_tools/user_tools.html");p.src=Browser.extension.getURL("content/share_tools/share_tools.html");t.src=Browser.extension.getURL("content/share_tools/email_sharing.html");e.src=Browser.extension.getURL("content/global_tools/global_tools.html");U=new Audio;U.src=Browser.extension.getURL("skitch/sounds/snap.wav");
B={callbacks:{highlightAdded:function(){K++},highlightDeleted:function(){K--}},settings:{imgPath:Browser.extension.getURL("clearly/images/")},window:window,jQuery:window.jQuery};B=initClearlyComponent__highlight(B);B.insertCSS();B.addMouseHandlers()})();Object.preventExtensions(this)}Object.preventExtensions(Coordinator);
