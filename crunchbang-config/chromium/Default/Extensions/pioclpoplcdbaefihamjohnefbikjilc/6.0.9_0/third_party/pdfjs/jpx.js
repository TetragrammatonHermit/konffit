var JpxImage=function(){function va(){this.failOnCorruptedImage=!1}function R(a,h){return a[h]<<24|a[h+1]<<16|a[h+2]<<8|a[h+3]}function J(a,h){return a[h]<<8|a[h+1]}function ma(a){for(var h=1,d=0;a>h;)h<<=1,d++;return d}function wa(a,h,d){a=d.xcb_;var f=d.ycb_,b=1<<a,g=1<<f,k=Math.floor(h.tbx0/b),c=Math.floor(h.tby0/g),e=Math.ceil(h.tbx1/b),z=Math.ceil(h.tby1/g),v=h.resolution.precinctParameters,D=[];d=[];for(var t=c;t<z;t++)for(c=k;c<e;c++){var n={cbx:c,cby:t,tbx0:b*c,tby0:g*t,tbx1:b*(c+1),tby1:g*
(t+1)},r=Math.floor((n.tby0-v.precinctYOffset)/v.precinctHeight)+Math.floor((n.tbx0-v.precinctXOffset)/v.precinctWidth)*v.numprecinctswide;n.tbx0_=Math.max(h.tbx0,n.tbx0);n.tby0_=Math.max(h.tby0,n.tby0);n.tbx1_=Math.min(h.tbx1,n.tbx1);n.tby1_=Math.min(h.tby1,n.tby1);n.precinctNumber=r;n.subbandType=h.type;n.Lblock=3;D.push(n);r in d?(r=d[r],r.cbxMin=Math.min(r.cbxMin,c),r.cbyMin=Math.min(r.cbyMin,t),r.cbxMax=Math.max(r.cbxMax,c),r.cbyMax=Math.max(r.cbyMax,t)):d[r]=r={cbxMin:c,cbyMin:t,cbxMax:c,cbyMax:t};
n.precinct=r}h.codeblockParameters={codeblockWidth:a,codeblockHeight:f,numcodeblockwide:e-k+1,numcodeblockhigh:z-z+1};h.codeblocks=D;c=0;for(a=D.length;c<a;c++);h.precincts=d}function na(a,h,d){var f=[];a=a.subbands;for(var b=0,g=a.length;b<g;b++)for(var k=a[b].codeblocks,c=0,e=k.length;c<e;c++){var z=k[c];z.precinctNumber==h&&f.push(z)}return{layerNumber:d,codeblocks:f}}function Kb(a){var h=a.tiles[a.currentTile.index],d=h.codingStyleDefaultParameters.layersCount,f=a.SIZ.Csiz,b=0;for(a=0;a<f;a++)b=
Math.max(b,h.components[a].codingStyleParameters.decompositionLevelsCount);var g=0,k=0,c=0,e=0;this.nextPacket=function(){for(;g<d;g++){for(;k<=b;k++){for(;c<f;c++){var a=h.components[c];if(!(k>a.codingStyleParameters.decompositionLevelsCount)){for(var a=a.resolutions[k],v=a.precinctParameters.numprecincts;e<v;)return a=na(a,e,g),e++,a;e=0}}c=0}k=0}throw"Out of packets";}}function Lb(a){var h=a.tiles[a.currentTile.index],d=h.codingStyleDefaultParameters.layersCount,f=a.SIZ.Csiz,b=0;for(a=0;a<f;a++)b=
Math.max(b,h.components[a].codingStyleParameters.decompositionLevelsCount);var g=0,k=0,c=0,e=0;this.nextPacket=function(){for(;g<=b;g++){for(;k<d;k++){for(;c<f;c++){var a=h.components[c];if(!(g>a.codingStyleParameters.decompositionLevelsCount)){for(var a=a.resolutions[g],v=a.precinctParameters.numprecincts;e<v;)return a=na(a,e,k),e++,a;e=0}}c=0}k=0}throw"Out of packets";}}function Mb(a,h,d,f){function b(b){for(;e<b;){var a=h[d+k];k++;z?(c=c<<7|a,e+=7,z=!1):(c=c<<8|a,e+=8);255==a&&(z=!0)}e-=b;return c>>>
e&(1<<b)-1}function g(){var c=b(1);if(0==c)return 1;c=c<<1|b(1);if(2==c)return 2;c=c<<2|b(2);if(14>=c)return(c&3)+3;c=c<<5|b(5);if(510>=c)return(c&31)+6;c=c<<7|b(7);return(c&127)+37}var k=0,c,e=0,z=!1;for(a=a.tiles[a.currentTile.index].packetsIterator;k<f;){var v=a.nextPacket();if(b(1)){for(var D=v.layerNumber,t=[],n=0,r=v.codeblocks.length;n<r;n++){var u=v.codeblocks[n],q=u.precinct,l=u.cbx-q.cbxMin,s=u.cby-q.cbyMin,x=!1,m=!1;if("included"in u)x=!!b(1);else{var q=u.precinct,p,y;if("inclusionTree"in
q)p=q.inclusionTree;else{y=q.cbxMax-q.cbxMin+1;var A=q.cbyMax-q.cbyMin+1;p=new Ka(y,A,D);y=new La(y,A);q.inclusionTree=p;q.zeroBitPlanesTree=y}if(p.reset(l,s,D))for(;;)if(b(1)){if(A=!p.nextLevel()){x=m=u.included=!0;break}}else{p.incrementValue(D);break}}if(x){if(m){y=q.zeroBitPlanesTree;for(y.reset(l,s);;)if(b(1)){if(A=!y.nextLevel())break}else y.incrementValue();u.zeroBitPlanes=y.value}for(q=g();b(1);)u.Lblock++;l=ma(q);l=b((q<1<<l?l-1:l)+u.Lblock);t.push({codeblock:u,codingpasses:q,dataLength:l})}}e=
0;z&&(k++,z=!1);for(;0<t.length;)v=t.shift(),u=v.codeblock,"data"in u||(u.data=[]),u.data.push({data:h,start:d+k,end:d+k+v.dataLength,codingpasses:v.codingpasses}),k+=v.dataLength}else e=0,z&&(k++,z=!1)}return k}var Nb={LL:0,LH:1,HL:1,HH:2};va.prototype={load:function(a){var h=new XMLHttpRequest;h.open("GET",a,!0);h.responseType="arraybuffer";h.onload=function(){var d=new Uint8Array(h.response||h.mozResponseArrayBuffer);this.parse(d);if(this.onload)this.onload()}.bind(this);h.send(null)},parse:function(a){function h(c,
b,d){for(var a=0,f=0;f<d;f++)a=256*a+(c[b+f]&255);return a}for(var d=0,f=a.length;d<f;){var b=8,g=h(a,d,4),k=h(a,d+4,4),d=d+b;1==g&&(g=h(a,d,8),d+=8,b+=8);0==g&&(g=f-d+b);g<b&&error("JPX error: Invalid box field size");b=g-b;g=!0;switch(k){case 1785737832:g=!1;break;case 1785737827:this.parseCodestream(a,d,d+b)}g&&(d+=b)}},parseCodestream:function(a,h,d){var f={};try{for(var b=h;b<d;){var g=J(a,b),b=b+2,k=0,c;switch(g){case 65359:f.mainHeader=!0;break;case 65497:break;case 65361:var k=J(a,b),e={};
e.Xsiz=R(a,b+4);e.Ysiz=R(a,b+8);e.XOsiz=R(a,b+12);e.YOsiz=R(a,b+16);e.XTsiz=R(a,b+20);e.YTsiz=R(a,b+24);e.XTOsiz=R(a,b+28);e.YTOsiz=R(a,b+32);var z=J(a,b+36);e.Csiz=z;var v=[];c=b+38;for(var D=0;D<z;D++){var t={precision:(a[c]&127)+1,isSigned:!!(a[c]&128),XRsiz:a[c+1],YRsiz:a[c+1]},n=t,r=e;n.x0=Math.ceil(r.XOsiz/n.XRsiz);n.x1=Math.ceil(r.Xsiz/n.XRsiz);n.y0=Math.ceil(r.YOsiz/n.YRsiz);n.y1=Math.ceil(r.Ysiz/n.YRsiz);n.width=n.x1-n.x0;n.height=n.y1-n.y0;v.push(t)}f.SIZ=e;f.components=v;for(var u=f,q=
v,l=u.SIZ,s=[],x=Math.ceil((l.Xsiz-l.XTOsiz)/l.XTsiz),m=Math.ceil((l.Ysiz-l.YTOsiz)/l.YTsiz),p=0;p<m;p++)for(var y=0;y<x;y++){var A={};A.tx0=Math.max(l.XTOsiz+y*l.XTsiz,l.XOsiz);A.ty0=Math.max(l.YTOsiz+p*l.YTsiz,l.YOsiz);A.tx1=Math.min(l.XTOsiz+(y+1)*l.XTsiz,l.Xsiz);A.ty1=Math.min(l.YTOsiz+(p+1)*l.YTsiz,l.Ysiz);A.width=A.tx1-A.tx0;A.height=A.ty1-A.ty0;A.components=[];s.push(A)}u.tiles=s;for(var V=0,ma=l.Csiz;V<ma;V++)for(var xa=q[V],Ma=0,va=s.length;Ma<va;Ma++){var K={},A=s[Ma];K.tcx0=Math.ceil(A.tx0/
xa.XRsiz);K.tcy0=Math.ceil(A.ty0/xa.YRsiz);K.tcx1=Math.ceil(A.tx1/xa.XRsiz);K.tcy1=Math.ceil(A.ty1/xa.YRsiz);K.width=K.tcx1-K.tcx0;K.height=K.tcy1-K.tcy0;A.components[V]=K}f.QCC=[];f.COC=[];break;case 65372:var k=J(a,b),ha={};c=b+2;var $=a[c++],O,W;switch($&31){case 0:O=8;W=!0;break;case 1:O=16;W=!1;break;case 2:O=16;W=!0;break;default:throw"Invalid SQcd value "+$;}ha.noQuantization=8==O;ha.scalarExpounded=W;ha.guardBits=$>>5;for(var oa=[];c<k+b;){var L={};8==O?(L.epsilon=a[c++]>>3,L.mu=0):(L.epsilon=
a[c]>>3,L.mu=(a[c]&7)<<8|a[c+1],c+=2);oa.push(L)}ha.SPqcds=oa;f.mainHeader?f.QCD=ha:(f.currentTile.QCD=ha,f.currentTile.QCC=[]);break;case 65373:var k=J(a,b),ia={};c=b+2;var ya;257>f.SIZ.Csiz?ya=a[c++]:(ya=J(a,c),c+=2);$=a[c++];switch($&31){case 0:O=8;W=!0;break;case 1:O=16;W=!1;break;case 2:O=16;W=!0;break;default:throw"Invalid SQcd value "+$;}ia.noQuantization=8==O;ia.scalarExpounded=W;ia.guardBits=$>>5;for(oa=[];c<k+b;)L={},8==O?(L.epsilon=a[c++]>>3,L.mu=0):(L.epsilon=a[c]>>3,L.mu=(a[c]&7)<<8|
a[c+1],c+=2),oa.push(L);ia.SPqcds=oa;f.mainHeader?f.QCC[ya]=ia:f.currentTile.QCC[ya]=ia;break;case 65362:var k=J(a,b),B={};c=b+2;var Na=a[c++];B.entropyCoderWithCustomPrecincts=!!(Na&1);B.sopMarkerUsed=!!(Na&2);B.ephMarkerUsed=!!(Na&4);B.progressionOrder=a[c++];B.layersCount=J(a,c);c+=2;B.multipleComponentTransform=a[c++];B.decompositionLevelsCount=a[c++];B.xcb=(a[c++]&15)+2;B.ycb=(a[c++]&15)+2;var ja=a[c++];B.selectiveArithmeticCodingBypass=!!(ja&1);B.resetContextProbabilities=!!(ja&2);B.terminationOnEachCodingPass=
!!(ja&4);B.verticalyStripe=!!(ja&8);B.predictableTermination=!!(ja&16);B.segmentationSymbolUsed=!!(ja&32);B.transformation=a[c++];if(B.entropyCoderWithCustomPrecincts){for(var na={};c<k+b;){var jb=a[c];na.push({PPx:jb&15,PPy:jb>>4})}B.precinctsSizes=na}if(B.sopMarkerUsed||B.ephMarkerUsed||B.selectiveArithmeticCodingBypass||B.resetContextProbabilities||B.terminationOnEachCodingPass||B.verticalyStripe||B.predictableTermination)throw"Unsupported COD options: "+globalScope.JSON.stringify(B);f.mainHeader?
f.COD=B:(f.currentTile.COD=B,f.currentTile.COC=[]);break;case 65424:var k=J(a,b),F={};F.index=J(a,b+2);F.length=R(a,b+4);F.dataEnd=F.length+b-2;F.partIndex=a[b+8];F.partsCount=a[b+9];f.mainHeader=!1;0==F.partIndex&&(F.COD=f.COD,F.COC=f.COC.slice(0),F.QCD=f.QCD,F.QCC=f.QCC.slice(0));f.currentTile=F;break;case 65427:F=f.currentTile;if(0==F.partIndex){for(var S=f,Ka=S.SIZ.Csiz,kb=S.tiles[F.index],aa=0;aa<Ka;aa++){var lb=kb.components[aa];lb.quantizationParameters=aa in S.currentTile.QCC?S.currentTile.QCC[aa]:
S.currentTile.QCD;lb.codingStyleParameters=aa in S.currentTile.COC?S.currentTile.COC[aa]:S.currentTile.COD}kb.codingStyleDefaultParameters=S.currentTile.COD;for(var T=f,za=T.tiles[T.currentTile.index],La=T.SIZ.Csiz,Oa=0;Oa<La;Oa++){for(var C=za.components[Oa],Pa=C.codingStyleParameters.decompositionLevelsCount,mb=[],pa=[],ka=0;ka<=Pa;ka++){var ba,Aa=ka,ca=C.codingStyleParameters,M={};ca.entropyCoderWithCustomPrecincts?(M.PPx=ca.precinctsSizes[Aa].PPx,M.PPy=ca.precinctsSizes[Aa].PPy):(M.PPx=15,M.PPy=
15);M.xcb_=0<Aa?Math.min(ca.xcb,M.PPx-1):Math.min(ca.xcb,M.PPx);M.ycb_=0<Aa?Math.min(ca.ycb,M.PPy-1):Math.min(ca.ycb,M.PPy);ba=M;var H={},X=1<<Pa-ka;H.trx0=Math.ceil(C.tcx0/X);H.try0=Math.ceil(C.tcy0/X);H.trx1=Math.ceil(C.tcx1/X);H.try1=Math.ceil(C.tcy1/X);var N=H,qa=1<<ba.PPx,ra=1<<ba.PPy,nb=N.trx1>N.trx0?Math.ceil(N.trx1/qa)-Math.floor(N.trx0/qa):0,ob=N.try1>N.try0?Math.ceil(N.try1/ra)-Math.floor(N.try0/ra):0;N.precinctParameters={precinctXOffset:Math.floor(N.trx0/qa)*qa,precinctYOffset:Math.floor(N.try0/
ra)*ra,precinctWidth:qa,precinctHeight:ra,numprecinctswide:nb,numprecinctshigh:ob,numprecincts:nb*ob};mb.push(H);var w;if(0==ka)w={type:"LL"},w.tbx0=Math.ceil(C.tcx0/X),w.tby0=Math.ceil(C.tcy0/X),w.tbx1=Math.ceil(C.tcx1/X),w.tby1=Math.ceil(C.tcy1/X),w.resolution=H,wa(T,w,ba),pa.push(w),H.subbands=[w];else{var I=1<<Pa-ka+1,Ba=[];w={type:"HL"};w.tbx0=Math.ceil(C.tcx0/I-0.5);w.tby0=Math.ceil(C.tcy0/I);w.tbx1=Math.ceil(C.tcx1/I-0.5);w.tby1=Math.ceil(C.tcy1/I);w.resolution=H;wa(T,w,ba);pa.push(w);Ba.push(w);
w={type:"LH"};w.tbx0=Math.ceil(C.tcx0/I);w.tby0=Math.ceil(C.tcy0/I-0.5);w.tbx1=Math.ceil(C.tcx1/I);w.tby1=Math.ceil(C.tcy1/I-0.5);w.resolution=H;wa(T,w,ba);pa.push(w);Ba.push(w);w={type:"HH"};w.tbx0=Math.ceil(C.tcx0/I-0.5);w.tby0=Math.ceil(C.tcy0/I-0.5);w.tbx1=Math.ceil(C.tcx1/I-0.5);w.tby1=Math.ceil(C.tcy1/I-0.5);w.resolution=H;wa(T,w,ba);pa.push(w);Ba.push(w);H.subbands=Ba}}C.resolutions=mb;C.subbands=pa}var pb=za.codingStyleDefaultParameters.progressionOrder;switch(pb){case 0:za.packetsIterator=
new Kb(T);break;case 1:za.packetsIterator=new Lb(T);break;default:throw"Unsupported progression order "+pb;}}k=F.dataEnd-b;Mb(f,a,b,k);break;case 65380:k=J(a,b);break;default:throw"Unknown codestream code: "+g.toString(16);}b+=k}}catch(qb){this.failOnCorruptedImage?error("JPX error: "+qb):warn("JPX error: "+qb+". Trying to recover")}for(var rb=f.components,Qa=f.SIZ.Csiz,sb=[],Ra=0,Ob=f.tiles.length;Ra<Ob;Ra++){for(var tb=f.tiles[Ra],Y=[],G=0;G<Qa;G++){for(var da=tb.components[G],Ca=da.codingStyleParameters,
Sa=da.quantizationParameters,Pb=Ca.decompositionLevelsCount,Da=Sa.SPqcds,Qb=Sa.scalarExpounded,Rb=Sa.guardBits,Ta=Ca.transformation,Sb=Ca.segmentationSymbolUsed,Tb=f.components[G].precision,ub=[],Ua=0,sa=0;sa<=Pb;sa++)for(var vb=da.resolutions[sa],Va=0,Ub=vb.subbands.length;Va<Ub;Va++){var Wa,Ea;Qb?(Wa=Da[Ua].mu,Ea=Da[Ua].epsilon):(Wa=Da[0].mu,Ea=Da[0].epsilon+(0<sa?1-sa:0));for(var Z=vb.subbands[Va],Xa=Z.tbx1-Z.tbx0,wb=Z.tby1-Z.tby0,Vb=Math.pow(2,Tb+Nb[Z.type]-Ea)*(1+Wa/2048),Wb=Rb+Ea-1,xb=new Float32Array(Xa*
wb),Xb=xb,Yb=Z.tbx0,Zb=Z.tby0,yb=Xa,$b=Vb,zb=Wb,Ab=Z.codeblocks,ac=Ta,bc=Sb,Ya=0,cc=Ab.length;Ya<cc;++Ya){var P=Ab[Ya],Fa=P.tbx1_-P.tbx0_,Za=P.tby1_-P.tby0_;if(0!=Fa&&0!=Za&&"data"in P){var U,Ga;U=new dc(Fa,Za,P.subbandType,P.zeroBitPlanes);Ga=2;for(var Ha=P.data,Ia=0,$a=0,Q=0,ab=Ha.length;Q<ab;Q++)var ea=Ha[Q],Ia=Ia+(ea.end-ea.start),$a=$a+ea.codingpasses;for(var Bb=new Uint8Array(Ia),la=0,Q=0,ab=Ha.length;Q<ab;Q++){var ea=Ha[Q],Cb=ea.data.subarray(ea.start,ea.end);Bb.set(Cb,la);la+=Cb.length}var fc=
new ec(Bb,0,Ia);U.setDecoder(fc);for(Q=0;Q<$a;Q++){switch(Ga){case 0:U.runSignificancePropogationPass();break;case 1:U.runMagnitudeRefinementPass();break;case 2:U.runCleanupPass(),bc&&U.checkSegmentationSymbol()}Ga=(Ga+1)%3}for(var bb=P.tbx0_-Yb+(P.tby0_-Zb)*yb,Ja=0,Db=0;Db<Za;Db++){for(la=0;la<Fa;la++){var fa=(U.coefficentsSign[Ja]?-1:1)*U.coefficentsMagnitude[Ja],Eb=U.bitsDecoded[Ja],cb;0==ac||zb>Eb?(fa+=0>fa?fa-0.5:0<fa?fa+0.5:0,cb=1<<zb-Eb):cb=1;Xb[bb++]=fa*cb*$b;Ja++}bb+=yb-Fa}}}ub.push({width:Xa,
height:wb,items:xb});Ua++}var Ta=Ca.transformation,db=(0==Ta?new gc:new hc).calculate(ub,da.tcx0,da.tcy0);Y.push({left:da.tcx0,top:da.tcy0,width:db.width,height:db.height,items:db.items})}if(tb.codingStyleDefaultParameters.multipleComponentTransform)for(var eb=Y[0].items,Fb=Y[1].items,Gb=Y[2].items,E=0,ta=eb.length;E<ta;E++){var Hb=Fb[E],Ib=Gb[E],fb=eb[E]-(Ib+Hb>>2);Fb[E]=fb;eb[E]=Ib+fb;Gb[E]=Hb+fb}for(G=0;G<Qa;G++){var ua=rb[G];if(!ua.isSigned)for(var gb=1<<ua.precision-1,hb=Y[G],ga=hb.items,E=0,
ta=ga.length;E<ta;E++)ga[E]+=gb}for(G=0;G<Qa;G++){for(var ua=rb[G],gb=ua.isSigned?128:0,ic=ua.precision-8,hb=Y[G],ga=hb.items,Jb=new Uint8Array(ga.length),E=0,ta=ga.length;E<ta;E++){var ib=(ga[E]>>ic)+gb;Jb[E]=0>ib?0:255<ib?255:ib}Y[G].items=Jb}sb.push(Y)}this.tiles=sb;this.width=f.SIZ.Xsiz-f.SIZ.XOsiz;this.height=f.SIZ.Ysiz-f.SIZ.YOsiz;this.componentsCount=f.SIZ.Csiz}};var La=function(){function a(a,d){var f=ma(Math.max(a,d))+1;this.levels=[];for(var b=0;b<f;b++)this.levels.push({width:a,height:d,
items:[]}),a=Math.ceil(a/2),d=Math.ceil(d/2)}a.prototype={reset:function(a,d){for(var f=0,b=0;f<this.levels.length;){var g=this.levels[f],k=a+d*g.width;if(k in g.items){b=g.items[k];break}g.index=k;a>>=1;d>>=1;f++}f--;g=this.levels[f];g.items[g.index]=b;this.currentLevel=f;delete this.value},incrementValue:function(){var a=this.levels[this.currentLevel];a.items[a.index]++},nextLevel:function(){var a=this.currentLevel,d=this.levels[a],f=d.items[d.index];a--;if(0>a)return this.value=f,!1;this.currentLevel=
a;d=this.levels[a];d.items[d.index]=f;return!0}};return a}(),Ka=function(){function a(a,d,f){var b=ma(Math.max(a,d))+1;this.levels=[];for(var g=0;g<b;g++){for(var k=new Uint8Array(a*d),c=0,e=k.length;c<e;c++)k[c]=f;this.levels.push({width:a,height:d,items:k});a=Math.ceil(a/2);d=Math.ceil(d/2)}}a.prototype={reset:function(a,d,f){for(var b=0;b<this.levels.length;){var g=this.levels[b],k=a+d*g.width;g.index=k;g=g.items[k];if(255==g)break;if(g>f)return this.currentLevel=b,this.propagateValues(),!1;a>>=
1;d>>=1;b++}this.currentLevel=b-1;return!0},incrementValue:function(a){var d=this.levels[this.currentLevel];d.items[d.index]=a+1;this.propagateValues()},propagateValues:function(){for(var a=this.currentLevel,d=this.levels[a],f=d.items[d.index];0<=--a;)d=this.levels[a],d.items[d.index]=f},nextLevel:function(){var a=this.currentLevel,d=this.levels[a],f=d.items[d.index];d.items[d.index]=255;a--;if(0>a)return!1;this.currentLevel=a;d=this.levels[a];d.items[d.index]=f;return!0}};return a}(),ec=function(){function a(a,
f,b){this.data=a;this.bp=f;this.dataEnd=b;this.chigh=a[f];this.clow=0;this.byteIn();this.chigh=this.chigh<<7&65535|this.clow>>9&127;this.clow=this.clow<<7&65535;this.ct-=7;this.a=32768}var h=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,
nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},
{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},
{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];a.prototype=
{byteIn:function(){var a=this.data,f=this.bp;255==a[f]?143<a[f+1]?(this.clow+=65280,this.ct=8):(f++,this.clow+=a[f]<<9,this.ct=7,this.bp=f):(f++,this.clow+=f<this.dataEnd?a[f]<<8:65280,this.ct=8,this.bp=f);65535<this.clow&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(a){var f=h[a.index].qe;this.a-=f;if(this.chigh<f)return a=this.exchangeLps(a),this.renormD(),a;this.chigh-=f;return 0==(this.a&32768)?(a=this.exchangeMps(a),this.renormD(),a):a.mps},renormD:function(){do 0==this.ct&&
this.byteIn(),this.a<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--;while(0==(this.a&32768))},exchangeMps:function(a){var f,b=h[a.index];this.a<b.qe?(f=1-a.mps,1==b.switchFlag&&(a.mps=1-a.mps),a.index=b.nlps):(f=a.mps,a.index=b.nmps);return f},exchangeLps:function(a){var f,b=h[a.index];this.a<b.qe?(this.a=b.qe,f=a.mps,a.index=b.nmps):(this.a=b.qe,f=1-a.mps,1==b.switchFlag&&(a.mps=1-a.mps),a.index=b.nlps);return f}};return a}(),dc=function(){function a(a,
b,c,e){this.width=a;this.height=b;this.contextLabelTable="HH"==c?f:"HL"==c?d:h;a*=b;this.neighborsSignificance=new Uint8Array(a);this.coefficentsSign=new Uint8Array(a);this.coefficentsMagnitude=new Uint32Array(a);this.processingFlags=new Uint8Array(a);a=new Uint8Array(this.width*this.height);b=0;for(c=a.length;b<c;b++)a[b]=e;this.bitsDecoded=a;this.reset()}var h=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,
0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),d=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),f=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]),b=[{contextLabel:13,xorBit:0},{contextLabel:12,xorBit:0},{contextLabel:11,xorBit:0},{contextLabel:10,xorBit:0},{contextLabel:9,xorBit:0},
{contextLabel:10,xorBit:1},{contextLabel:11,xorBit:1},{contextLabel:12,xorBit:1},{contextLabel:13,xorBit:1}];a.prototype={setDecoder:function(a){this.decoder=a},reset:function(){this.uniformContext={index:46,mps:0};this.runLengthContext={index:3,mps:0};this.contexts=[];this.contexts.push({index:4,mps:0});for(var a=1;16>=a;a++)this.contexts.push({index:0,mps:0})},setNeighborsSignificance:function(a,b){var c=this.neighborsSignificance,e=this.width,f=this.height,d=a*e+b;0<a&&(0<b&&(c[d-e-1]+=16),b+1<
e&&(c[d-e+1]+=16),c[d-e]+=4);a+1<f&&(0<b&&(c[d+e-1]+=16),b+1<e&&(c[d+e+1]+=16),c[d+e]+=4);0<b&&(c[d-1]+=1);b+1<e&&(c[d+1]+=1);c[d]|=128},runSignificancePropogationPass:function(){for(var a=this.decoder,b=this.width,c=this.height,e=this.coefficentsMagnitude,f=this.coefficentsSign,d=this.neighborsSignificance,h=this.processingFlags,t=this.contexts,n=this.contextLabelTable,r=this.bitsDecoded,u=0,q=b*c;u<q;u++)h[u]&=-2;for(u=0;u<c;u+=4)for(q=0;q<b;q++)for(var l=u*b+q,s=0;4>s;s++,l+=b){var x=u+s;if(x>=
c)break;if(!e[l]&&d[l]){if(a.readBit(t[n[d[l]]])){var m=this.decodeSignBit(x,q);f[l]=m;e[l]=1;this.setNeighborsSignificance(x,q);h[l]|=2}r[l]++;h[l]|=1}}},decodeSignBit:function(a,f){var c=this.width,e=a*c+f,d=this.coefficentsMagnitude,h=this.coefficentsSign,c=b[3*(1-(f+1<c&&d[e+1]?h[e+1]?0<f&&d[e-1]?h[e-1]?-1:0:-1:0<f&&d[e-1]?h[e-1]?0:1:1:0<f&&d[e-1]?h[e-1]?-1:1:0))+(1-(a+1<this.height&&d[e+c]?h[e+c]?0<a&&d[e-c]?h[e-c]?-1:0:-1:0<a&&d[e-c]?h[e-c]?0:1:1:0<a&&d[e-c]?h[e-c]?-1:1:0))];return this.decoder.readBit(this.contexts[c.contextLabel])^
c.xorBit},runMagnitudeRefinementPass:function(){for(var a=this.decoder,b=this.width,c=this.height,e=this.coefficentsMagnitude,d=this.neighborsSignificance,f=this.contexts,h=this.bitsDecoded,t=this.processingFlags,n=0;n<c;n+=4)for(var r=0;r<b;r++)for(var u=0;4>u;u++){var q=n+u;if(q>=c)break;var l=q*b+r;if(e[l]&&0==(t[l]&1)){var s=16;0!=(t[l]&2)&&(t[q*b+r]^=2,q=d[l],s=1<=(q&3)+(q>>2&3)+(q>>4&7)?15:14);q=a.readBit(f[s]);e[l]=e[l]<<1|q;h[l]++;t[l]|=1}}},runCleanupPass:function(){for(var a=this.decoder,
b=this.width,c=this.height,e=this.neighborsSignificance,d=this.coefficentsMagnitude,f=this.coefficentsSign,h=this.contexts,t=this.contextLabelTable,n=this.bitsDecoded,r=this.processingFlags,u=2*b,q=3*b,l=0;l<c;l+=4)for(var s=0;s<b;s++){var x=l*b+s,m=0,p=x,y,A;if(l+3<c&&0==r[x]&&0==r[x+b]&&0==r[x+u]&&0==r[x+q]&&0==e[x]&&0==e[x+b]&&0==e[x+u]&&0==e[x+q]){y=this.runLengthContext;if(!a.readBit(y)){n[x]++;n[x+b]++;n[x+u]++;n[x+q]++;continue}y=this.uniformContext;m=a.readBit(y)<<1|a.readBit(y);A=l+m;p+=
m*b;y=this.decodeSignBit(A,s);f[p]=y;d[p]=1;this.setNeighborsSignificance(A,s);r[p]|=2;p=x;for(x=l;x<=A;x++,p+=b)n[p]++;m++}for(;4>m;m++,p+=b){A=l+m;if(A>=c)break;d[p]||0!=(r[p]&1)||(y=h[t[e[p]]],1==a.readBit(y)&&(y=this.decodeSignBit(A,s),f[p]=y,d[p]=1,this.setNeighborsSignificance(A,s),r[p]|=2),n[p]++)}}},checkSegmentationSymbol:function(){var a=this.decoder,b=this.uniformContext;if(10!=(a.readBit(b)<<3|a.readBit(b)<<2|a.readBit(b)<<1|a.readBit(b)))throw"Invalid segmentation symbol";}};return a}(),
V=function(){function a(){}a.prototype.calculate=function(a,d,f){for(var b=a[0],g=1,k=a.length,c=1;g<k;g+=3,c++)b=this.iterate(b,a[g],a[g+1],a[g+2],d,f);return b};a.prototype.iterate=function(a,d,f,b,g,k){var c=a.width,e=a.height;a=a.items;var z=d.width,v=d.height,D=d.items,t=f.width,n=f.height,r=f.items,u=b.width,q=b.height,l=b.items;b=c+z;f=e+n;d=new Float32Array(b*f);for(var s=0,x=e;s<x;s++)for(var e=s*c,m=2*s*b,p=0,y=c;p<y;p++,e++,m+=2)d[m]=a[e];s=0;for(x=v;s<x;s++)for(e=s*z,m=2*s*b+1,p=0,y=z;p<
y;p++,e++,m+=2)d[m]=D[e];s=0;for(x=n;s<x;s++)for(e=s*t,m=(2*s+1)*b,p=0,y=t;p<y;p++,e++,m+=2)d[m]=r[e];s=0;for(x=q;s<x;s++)for(e=s*u,m=(2*s+1)*b+1,p=0,y=u;p<y;p++,e++,m+=2)d[m]=l[e];a=new Float32Array(Math.max(b,f)+8);c=new Float32Array(a);a=new Float32Array(a);for(z=0;z<f;z++)if(1==b)0!=g%1&&(d[z*b]/=2);else{e=z*b;m=4;for(v=0;v<b;v++,e++,m++)c[m]=d[e];e=3;m=5;D=4+b-2;t=4+b;c[e--]=c[m++];c[t++]=c[D--];c[e--]=c[m++];c[t++]=c[D--];c[e--]=c[m++];c[t++]=c[D--];c[e--]=c[m++];c[t++]=c[D--];this.filter(c,
4,b,g,a);e=z*b;m=4;for(v=0;v<b;v++,e++,m++)d[e]=a[m]}for(v=0;v<b;v++)if(1==f)0!=k%1&&(d[v]/=2);else{e=v;m=4;for(z=0;z<f;z++,e+=b,m++)c[m]=d[e];e=3;m=5;D=4+f-2;t=4+f;c[e--]=c[m++];c[t++]=c[D--];c[e--]=c[m++];c[t++]=c[D--];c[e--]=c[m++];c[t++]=c[D--];c[e--]=c[m++];c[t++]=c[D--];this.filter(c,4,f,k,a);e=v;m=4;for(z=0;z<f;z++,e+=b,m++)d[e]=a[m]}return{width:b,height:f,items:d}};return a}(),gc=function(){function a(){V.call(this)}a.prototype=Object.create(V.prototype);a.prototype.filter=function(a,d,f,
b,g){var k=Math.floor(b/2);f=Math.floor((b+f)/2);d-=b%1;b=d-2;for(var c=k-1,e=f+2;c<e;c++,b+=2)g[b]=1.230174104914001*a[b];b=d-3;c=k-2;for(e=f+2;c<e;c++,b+=2)g[b]=0.8128930661159609*a[b];b=d-2;c=k-1;for(e=f+2;c<e;c++,b+=2)g[b]-=0.443506852043971*(g[b-1]+g[b+1]);b=d-1;c=k-1;for(e=f+1;c<e;c++,b+=2)g[b]-=0.882911075530934*(g[b-1]+g[b+1]);b=d;c=k;for(e=f+1;c<e;c++,b+=2)g[b]-=-0.052980118572961*(g[b-1]+g[b+1]);b=d+1;c=k;for(e=f;c<e;c++,b+=2)g[b]-=-1.586134342059924*(g[b-1]+g[b+1])};return a}(),hc=function(){function a(){V.call(this)}
a.prototype=Object.create(V.prototype);a.prototype.filter=function(a,d,f,b,g){var k=Math.floor(b/2);f=Math.floor((b+f)/2);d-=b%1;b=k;for(var c=f+1,e=d;b<c;b++,e+=2)g[e]=a[e]-Math.floor((a[e-1]+a[e+1]+2)/4);b=k;c=f;for(e=d+1;b<c;b++,e+=2)g[e]=a[e]+Math.floor((g[e-1]+g[e+1])/2)};return a}();return va}();
