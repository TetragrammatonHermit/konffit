(function(){function d(){return window===window.parent&&/^((www|stage|stage-corp|stage-china)\.)?(evernote|yinxiang)\.com$/i.test(document.location.host)&&/^.*?\/webclipper\/whats_new\/?$/i.test(document.location.pathname)&&"?firstlaunch"===document.location.search.toLowerCase()}function l(){this.removeEventListener("click",arguments.callee);var b=document.querySelector("#webclipper-fle-markup");b.addEventListener("webkitTransitionEnd",m);b.style.opacity="0"}function m(){this.removeEventListener("webkitTransitionEnd",
arguments.callee);this.style.display="none";e||(a.style.display="block",a.contentWindow.postMessage({name:"taskFinished",type:"markup"},Browser.extension.getURL("")),e=!0)}function n(b,a,c){a=document.createElement("div");a.id="webclipper-fle-markup";a.innerHTML=b.response;GlobalUtils.localize(a);document.documentElement.appendChild(a);SAFARI&&(b=document.createElement("link"),b.rel="stylesheet",b.href=Browser.extension.getURL("content/fle/flemarkup.css"),document.documentElement.appendChild(b));
a.style.opacity="1";a.querySelector(".next-button").addEventListener("click",l)}function f(b,c,d){document.getElementById("evernoteGlobalTools")?(document.getElementById("evernoteGlobalTools").style.zIndex="0",a=document.createElement("IFRAME"),a.id="evernoteFlePage",a.src=Browser.extension.getURL("content/fle/fle.html"),a.seamless=!0,document.documentElement.appendChild(a)):setTimeout(function(){f()},300)}function p(b,c,d){a.contentWindow.postMessage({name:"taskFinished",type:b.type},Browser.extension.getURL(""))}
function g(){!h&&c&&(h=!0,Browser.sendToExtension({name:"tourLoaded"}))}function q(){a.contentWindow.postMessage({name:"taskFinished",type:"screenshot"},Browser.extension.getURL(""))}var a,e=!1,c="undefined"===typeof document.hidden?!0:!document.hidden,h=!1;d()&&(window.addEventListener("unload",function(){Browser.sendToExtension({name:"finishTour"})}),document.addEventListener("visibilitychange",function(){c=!document.hidden||c;g()}),Browser.addMessageHandlers({receiveXMLHttpRequest:n,startTour:f,
taskFinished:p}),window.addEventListener("message",function(b){if("eventDetected"==b.data.name)a.contentWindow.postMessage(b.data,Browser.extension.getURL(""));else if("fleMarkUp"==b.data.name)a&&d()&&(Browser.sendToExtension({name:"loadXMLHttpRequest",url:Browser.extension.getURL("content/fle/flemarkup.html")}),a.style.display="none");else if("redirect"==b.data.name)Browser.sendToExtension({name:"finishTour"}),document.location.replace(document.location.protocol+"//"+document.location.host+document.location.pathname+
"?firstlaunchreturn");else if("getLocation"==b.data.name){b={name:"getLocationReply",location:{}};for(k in location){var c=location[k];"string"==typeof c&&(b.location[k]=c)}a.contentWindow.postMessage(b,Browser.extension.getURL(""))}}),window.screenshotDone=q,g())})();
