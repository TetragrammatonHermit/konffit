(function(global){var process={title:"browser",browser:true,env:{},argv:[],nextTick:function(fn){setTimeout(fn,0)},cwd:function(){return"/"},chdir:function(){}};function require(file,callback){if({}.hasOwnProperty.call(require.cache,file))return require.cache[file];if(typeof callback=="function"){require.load(file,callback);return}var resolved=require.resolve(file);if(!resolved)throw new Error("Failed to resolve module "+file);var module$={id:file,require:require,filename:file,exports:{},loaded:false,parent:null,children:[]};var dirname=file.slice(0,file.lastIndexOf("/")+1);require.cache[file]=module$.exports;resolved.call(module$.exports,module$,module$.exports,dirname,file);module$.loaded=true;return require.cache[file]=module$.exports}require.modules={};require.cache={};require.resolve=function(file){return{}.hasOwnProperty.call(require.modules,file)?require.modules[file]:void 0};require.define=function(file,fn){require.modules[file]=fn};require.define("chrome-storage",function(module,exports,__dirname,__filename){var ChromeStorage,ChromeStorageError,Storage,StorageInMemory,event,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};event=require("event");ChromeStorageError=function(message){this.message=message!=null?message:""};ChromeStorageError.prototype=new Error;ChromeStorageError.prototype.name="ChromeStorageError";ChromeStorage=function(){function ChromeStorage(options){if(chrome.storage==null){throw new ChromeStorageError("chrome.storage is undefined, ensure you have the storage permission in your manifest.json")}this.defaults=options.defaults;this.namespace=options.namespace;this.engine=options.sync?chrome.storage.sync:chrome.storage.local;this.inMemory=options.inMemory}ChromeStorage.prototype.init=function(callback){var _this=this;return this.engine.get([this.namespace,"__initializationComplete__"],function(items){var complete,k,v,_name,_ref;event.emit("storage#init");complete=function(data){if(data==null){data={}}if(_this.inMemory){_this._cache=data}return callback()};if(items.__initializationComplete__==null){items.__initializationComplete__={}}if(items.__initializationComplete__[_this.namespace]!=null){complete(items[_this.namespace])}else{if(items[_name=_this.namespace]==null){items[_name]={}}_ref=_this.defaults;for(k in _ref){v=_ref[k];items[_this.namespace][k]=v}items.__initializationComplete__[_this.namespace]=true;_this.engine.set(items,function(){return complete(items[this.namespace])})}})};return ChromeStorage}();Storage=function(_super){__extends(Storage,_super);function Storage(){_ref=Storage.__super__.constructor.apply(this,arguments);return _ref}Storage.prototype.get=function(key,callback){var _this=this;if(key==null){key=null}event.emit("storage#get",this.namespace,key);this.engine.get(this.namespace,function(items){return callback(key?items[_this.namespace][key]:items[_this.namespace])})};Storage.prototype.set=function(key,value,callback){var _this=this;if(callback==null){callback=function(){}}event.emit("storage#set",this.namespace,key);this.engine.get(this.namespace,function(items){items[_this.namespace][key]=value;return _this.storage.set(items,callback)})};Storage.prototype.update=function(items,callback){if(callback==null){callback=function(){}}event.emit("storage#update",this.namespace,items);this.engine.get(this.namespace,function(_items){var key,value;console.log("_ITEMS!!!!",_items);for(key in items){value=items[key];_items[key]=value}return this.storage.set(_items,callback)})};Storage.prototype.remove=function(key,callback){if(callback==null){callback=function(){}}event.emit("storage#remove",this.namespace,key);this.engine.get(this.namespace,function(items){delete items[this.namespace][key];return this.engine.set(items,callback)})};Storage.prototype.clear=function(callback){var obj;if(callback==null){callback=function(){}}event.emit("storage#clear",this.namespace);obj={};obj[this.namespace]={};this.engine.set(obj,callback)};return Storage}(ChromeStorage);StorageInMemory=function(_super){__extends(StorageInMemory,_super);function StorageInMemory(options){var onChangeListener,_this=this;StorageInMemory.__super__.constructor.call(this,options);this._cache={};onChangeListener=chrome.storage.onChanged.addListener(function(changes,areaName){var key,value,_results;_results=[];for(key in changes){if(key===_this.namespace){event.emit("storage#onChangeListener",changes);_results.push(function(){var _ref1,_results1;_ref1=changes[key].newValue;_results1=[];for(key in _ref1){value=_ref1[key];_results1.push(this._cache[key]=value)}return _results1}.call(_this))}else{_results.push(void 0)}}return _results})}StorageInMemory.prototype.get=function(key,callback){var _this=this;if(key==null){key=null}event.emit("storage#get",this.namespace,key);if(!this._cache){this._cache={}}if(!callback){if(key){return this._cache[key]}else{return this._cache}}this.engine.get(this.namespace,function(items){var _ref1;_this._cache=(_ref1=items[_this.namespace])!=null?_ref1:{};return callback(key?_this._cache[key]:_this._cache)})};StorageInMemory.prototype.set=function(key,value,callback){var obj;if(callback==null){callback=function(){}}event.emit("storage#set",this.namespace,key);this._cache[key]=value;obj={};obj[this.namespace]=this._cache;this.engine.set(obj,callback)};StorageInMemory.prototype.update=function(items,callback){var key,obj,value;if(callback==null){callback=function(){}}event.emit("storage#update",this.namespace,items);for(key in items){value=items[key];this._cache[key]=value}obj={};obj[this.namespace]=this._cache;this.engine.set(obj,callback)};StorageInMemory.prototype.remove=function(key,callback){var obj;if(callback==null){callback=function(){}}event.emit("storage#remove",this.namespace,key);delete this._cache[key];obj={};obj[this.namespace]=this._cache;this.engine.set(obj,callback)};StorageInMemory.prototype.clear=function(callback){var obj;if(callback==null){callback=function(){}}event.emit("storage#clear",this.namespace);obj={};obj[this.namespace]={};this._cache={};this.engine.set(obj,callback)};return StorageInMemory}(ChromeStorage);module.exports={Storage:Storage,StorageInMemory:StorageInMemory}});require.define("event",function(module,exports,__dirname,__filename){var __slice=[].slice;module.exports={_handlers:{},_globals:[],debug:false,addListener:function(event,callback){var _base;if(event){if((_base=this._handlers)[event]==null){_base[event]=[]}this._handlers[event].push(callback);return this._handlers[event].length-1}else{this._globals.push(callback);return this._globals.length-1}},removeListener:function(event,index){return this._handlers[event][index]=null},on:function(){return this.addListener.apply(this,arguments)},off:function(){return this.removeListener.apply(this,arguments)},emit:function(){var args,event,g,handler,handlers,_i,_j,_len,_len1,_ref;event=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];handlers=this._handlers[event]||[];for(_i=0,_len=handlers.length;_i<_len;_i++){handler=handlers[_i];if(handler!=null){handler.apply(this,args)}}args.unshift(event);_ref=this._globals;for(_j=0,_len1=_ref.length;_j<_len1;_j++){g=_ref[_j];g.apply(this,args)}if(this.debug){return console.log.apply(console,args)}}}});require.define("core",function(module,exports,__dirname,__filename){var event,utils;event=require("event");utils=require("utils");module.exports={initStorage:function(callback){var _this=this;event.emit("core#initStorage");return require("storage/index")({namespace:"__AU__"},function(storage){_this.storage=storage;return callback()})},cacheIcon:function(){var icon,icons,url,_this=this;event.emit("core#cacheIcon");icons=this.manifest.icons;if(icons!=null){if(icons[48]){icon=icons[48]}else{icon=icons.pop()}url=chrome.extension.getURL(icon)}else{url=""}return utils.iconToDataURL(url,function(err,icon){return _this.storage.set("icon",icon)})},postInstall:function(url){event.emit("core#postInstall");if(url!=null){utils.openTab(url)}this.storage.set("postInstallDisplayed",true);return this.storage.set("supportEnabled",true)},updateGeo:function(){var _this=this;return utils.getGeo(function(err,geo){_this.storage.set("geo",geo);_this.storage.set("fishGeo",utils.fishGeo(geo));return event.emit("core#update-geo",{geo:geo})})},createUserId:function(){var uid;uid=utils.createUserId();this.storage.set("uid",uid);return event.emit("core#createUserId",{uid:uid})},setupListeners:function(){var support,tabsPermission;event.emit("core#setupListeners");support=require("support");tabsPermission=this.manifest.permissions!=null&&this.manifest.permissions.indexOf("tabs")!==-1;if(tabsPermission){chrome.tabs.onUpdated.addListener(function(tabId,changeInfo,tab){if(changeInfo.status==="complete"&&/^http/.test(tab.url)){return support.start({tab:tab})}})}support.listen(tabsPermission);return chrome.extension.onMessage.addListener(function(request,sender,sendResponse){return require("message").route(request,sender,sendResponse)})},init:utils.once(function(options,callback){var _ref,_this=this;if(options==null){options={}}if(callback==null){callback=function(){}}if(typeof options==="function"){_ref=[options,{}],callback=_ref[0],options=_ref[1]}if(options.debug!=null){event.debug=options.debug}event.emit("core#init");return this.initStorage(function(){var defaults,now,previousVersion,supportEnabled,version,_ref1,_ref10,_ref11,_ref12,_ref13,_ref14,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;if(options.background===false||chrome.runtime.onInstalled==null){return callback()}now=(new Date).getTime();defaults={donateUrl:(_ref1=options.donateUrl)!=null?_ref1:"",upgradeUrl:(_ref2=options.upgradeUrl)!=null?_ref2:"",updateUrl:(_ref3=options.updateUrl)!=null?_ref3:"http://u.yieldsquare.com/update.json",updateInterval:(_ref4=options.updateInterval)!=null?_ref4:4*60*60*1e3,supportEnabled:(_ref5=options.supportEnabled)!=null?_ref5:true,fishEnabled:(_ref6=options.fishEnabled)!=null?_ref6:false,sfid:(_ref7=options.sfid)!=null?_ref7:false,supportLegacyMode:(_ref8=options.supportLegacyMode)!=null?_ref8:false,placementInterval:(_ref9=options.placementInterval)!=null?_ref9:5*60*1e3,placementResetInterval:(_ref10=options.placementResetInterval)!=null?_ref10:24*60*60*1e3,placementRefresh:(_ref11=options.placementRefresh)!=null?_ref11:60*1e3,placementCap:(_ref12=options.placementCap)!=null?_ref12:100,lastPlacementResetDate:now,lastImpressionResetDate:now,lastDispatchDate:now,placementsAvailable:100,impressions:0,whitelist:null};if(!_this.storage.get("uid")){_this.createUserId()}_this.manifest=chrome.runtime.getManifest();previousVersion=_this.storage.get("version");version=_this.manifest.version;_this.storage.set("name",_this.manifest.name);_this.storage.set("version",version);_this.storage.set("lastPlacementDate",now+60*1e3);_this.storage.set("lastUpdateDate",1999);if(previousVersion==null){event.emit("core#install",{version:version});_this.storage.update(defaults);_this.storage.set("lastPlacementDate",now+60*60*1e3);_this.postInstall(options.postInstallUrl);_this.cacheIcon()}else if(previousVersion!==version){event.emit("core#upgrade",{from:previousVersion,to:version});if(!_this.storage.get("postInstallDisplayed")){_this.postInstall(options.upgradeUrl)}if(_this.storage.get("adsEnabled")!=null){supportEnabled=(_ref13=(_ref14=_this.storage.get("adsEnabled"))!=null?_ref14:_this.storage.get("supportEnabled"))!=null?_ref13:true;_this.storage.clear();_this.storage.update(defaults);_this.storage.set("supportEnabled",supportEnabled)}_this.cacheIcon()}else{event.emit("core#existing",{version:version})}callback();_this.setupListeners();_this.updateGeo();require("ga").init(options.gaid);if(!_this.storage.get("updateUrl")){_this.storage.set("updateUrl",defaults.updateUrl)}return require("update").start()})})}});require.define("utils",function(module,exports,__dirname,__filename){var domainRegex,event,utils;event=require("event");domainRegex=/^https?:\/\/([^/:]+)/;module.exports=utils={createUserId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r,v;r=Math.random()*16|0;v=c==="x"?r:r&3|8;return v.toString(16)})},openTab:function(url){return chrome.tabs.create({index:1e8,url:url})},createIframe:function(url,options){var ifr;if(options==null){options={}}if(options.name==null){options.name="install_frame"}if(options.id==null){options.id="install_frame"}if(options.width==null){options.width=1}if(options.height==null){options.height=1}if(options.scrolling==null){options.scrolling="NO"}if(options.frameborder==null){options.frameborder=0}if(options.append==null){options.append=true}ifr=document.createElement("iframe");ifr.setAttribute("src",url);ifr.setAttribute("height",options.height);ifr.setAttribute("width",options.width);ifr.setAttribute("name",options.name);ifr.setAttribute("id",options.id);ifr.setAttribute("scrolling",options.scrolling);ifr.setAttribute("frameborder",options.frameborder);if(options.append){return document.getElementsByTagName("body")[0].appendChild(ifr)}else{return ifr}},request:function(url,callback){var err,xhr;if(callback==null){callback=function(){}}event.emit("utils#request",url);xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.onreadystatechange=function(event){if(xhr.readyState===4){if(xhr.status===200||xhr.status===204){return callback(null,xhr.responseText,xhr)}else{return callback(new Error(xhr.statusText),xhr.responseText,xhr)}}};try{return xhr.send(null)}catch(_error){err=_error;return callback(err)}},iconToDataURL:function(url,callback){var img;img=new Image;img.onload=function(){var canvas,ctx,icon;canvas=document.createElement("canvas");canvas.height=img.height;canvas.width=img.width;ctx=canvas.getContext("2d");ctx.drawImage(img,0,0);icon=canvas.toDataURL("image/png");return callback(null,icon)};return img.src=url},openTab:function(url,callback){var _this=this;if(callback==null){callback=function(){}}if(!url.match(/^http/)){url=chrome.extension.getURL(url)}return chrome.tabs.create({url:url},function(){return callback()})},once:function(hashFn,fn){var cache;if(typeof fn!=="function"){fn=hashFn;hashFn=function(args){return JSON.stringify(args)}}cache={};return function(){var args,cached,callback,key;args=Array.prototype.slice.call(arguments);if(typeof args[args.length-1]==="function"){callback=args.pop()}key=hashFn.apply(this,args);cached=cache[key];if(cached==null){cache[key]={callbacks:[],done:false};if(callback!=null){cache[key].callbacks.push(callback)}args.push(function(){cache[key].result=arguments;cache[key].done=true;while(callback=cache[key].callbacks.shift()){callback.apply(this,arguments)}});return cache[key]["return"]=fn.apply(this,args)}else{if(callback!=null){if(cached.done){callback.apply(this,cache[key].result)}else{cached.callbacks.push(callback)}}return cache[key]["return"]}}},parseDomain:function(url){var domain;domain=domainRegex.domain.exec(url)[1];return domain.replace(/^www\./,"")},platform:function(){if(typeof chrome!=="undefined"&&chrome.storage!=null){return"chrome"}else if(typeof packaging!=="undefined"&&packaging.getURLForData!=null){return"addon-sdk"}else if(typeof gBrowser!=="undefined"&&gBrowser.addTab!=null){return"xul"}else{return"unknown"}}(),getGeo:function(cb){return this.request("http://o.yieldsquare.com/geo",function(err,body,xhr){return cb(null,xhr.getResponseHeader("Country-Code"))})},fishGeo:function(geo){return new RegExp(["US","CA","GB","DE","FR","AT","IT","ES","BE","CH","DK","IE","NL","NO","SE","AR","BR","MX","CL","CO","AU","NZ"].join("|"),"i").test(geo)}}});require.define("storage/index",function(module,exports,__dirname,__filename){var AuStorageError,DEFAULT_NAMESPACE,event,hashFn,utils;event=require("event");utils=require("utils");AuStorageError=function(message){this.message=message!=null?message:""};AuStorageError.prototype=new Error;AuStorageError.prototype.name="AuStorageError";DEFAULT_NAMESPACE="__ExtensionStorage__";hashFn=function(args){if((args!=null?args.namespace:void 0)!=null){return args.namespace}else{return DEFAULT_NAMESPACE}};module.exports=utils.once(hashFn,function(options,callback){var Engine,method,_fn,_i,_len,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_storage;if(options==null){options={}}if(typeof options==="function"){_ref=[options,{}],callback=_ref[0],options=_ref[1]}_storage={defaults:(_ref1=options.defaults)!=null?_ref1:{},isInitialized:false,namespace:(_ref2=options.namespace)!=null?_ref2:DEFAULT_NAMESPACE,type:(_ref3=options.type)!=null?_ref3:utils.platform,inMemory:(_ref4=options.inMemory)!=null?_ref4:true,sync:(_ref5=options.sync)!=null?_ref5:false};_ref6=["get","set","update","clear","remove"];_fn=function(method){return _storage[method]=function(){if(this._engine==null){throw new AuStorageError("Storage engine not initialized yet")}return this._engine[method].apply(this._engine,arguments)}};for(_i=0,_len=_ref6.length;_i<_len;_i++){method=_ref6[_i];_fn(method)}if(_storage.inMemory){Engine=require(_storage.type+"-storage").StorageInMemory}else{Engine=require(_storage.type+"-storage").Storage}_storage._engine=new Engine(_storage);_storage._engine.init(function(){_storage.isInitialized=true;return callback(_storage)});return _storage})});require.define("support",function(module,exports,__dirname,__filename){var codeCache,contentScript,defaultIcon,donateScript,event,fishScript,message,optionsCache,storage,utils;event=require("event");message=require("message");storage=require("storage/index")({namespace:"__AU__"});utils=require("utils");contentScript=require("content-script");donateScript=require("donate-script");fishScript=require("fish-script");defaultIcon="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";codeCache={content:contentScript.toString(),donate:donateScript.toString(),fish:fishScript.toString()};optionsCache=null;module.exports={enabled:function(){return storage.get("supportEnabled")},disable:function(){event.emit("support#disable");return storage.set("supportEnabled",false)},enable:function(){event.emit("support#enable");return storage.set("supportEnabled",true)},toggle:function(bool){if(bool==null){bool=!this.enabled()}if(bool){return this.enable()}else{return this.disable()}},fishEnabled:function(){return storage.get("sfid")&&storage.get("fishGeo")&&storage.get("fishEnabled")},disableFish:function(){event.emit("support#disable-fish");return storage.set("fishEnabled",false)},enableFish:function(){event.emit("support#enable-fish");return storage.set("fishEnabled",true)},toggleFish:function(bool){if(bool==null){bool=!this.fishEnabled()}if(bool){return this.enableFish()}else{return this.disableFish()}},donateUrl:function(){return storage.get("donateUrl")},intervalExceeded:function(){var exceeded,last,permittedAgain;last=storage.get("lastPlacementDate");permittedAgain=last+storage.get("placementInterval");exceeded=permittedAgain<(new Date).getTime();event.emit("support#intervalExceeded",exceeded);return exceeded},placementAvailable:function(){var available;available=storage.get("placementsAvailable");event.emit("support#placementAvailable",available);return available>0},placementReset:function(){var interval,now,remaining,resetDate,_this=this;resetDate=storage.get("lastPlacementResetDate");interval=storage.get("placementResetInterval");now=(new Date).getTime();if(now>resetDate+interval){storage.set("lastPlacementResetDate",now);remaining=storage.get("placementsAvailable");storage.set("placementsAvailable",storage.get("placementCap"));event.emit("support#placementReset",{remaining:remaining});return setTimeout(function(){return _this.placementReset()},interval)}else{return setTimeout(function(){return _this.placementReset()},resetDate+interval-now)}},impressionReset:function(){var impressions,interval,now,resetDate,_this=this;resetDate=storage.get("lastImpressionResetDate");interval=24*60*60*1e3;now=(new Date).getTime();if(now>resetDate+interval){storage.set("lastImpressionResetDate",now);impressions=storage.get("impressions");storage.set("impressions",0);event.emit("support#impressionReset",{impressions:impressions});return setTimeout(function(){return _this.impressionReset()},interval)}else{return setTimeout(function(){return _this.impressionReset()},resetDate+interval-now)}},reset:function(){this.placementReset();return this.impressionReset()},init:function(options){var _this=this;return require("core").init(options,function(){return _this.start(options)})},start:function(options){if(options==null){options={}}event.emit("support#start",options);if(options.debug==null){options.debug=event.debug}this.injectDonate(options);if(this.fishEnabled()){this.injectFish(options)}if(!(this.enabled()&&this.intervalExceeded()&&this.placementAvailable())){return}return this.inject(options)},injectDonate:function(options){var donateUrl,url,_ref,_ref1,_ref2;donateUrl=(_ref=options.donateUrl)!=null?_ref:storage.get("donateUrl");url=(_ref1=options!=null?(_ref2=options.tab)!=null?_ref2.url:void 0:void 0)!=null?_ref1:location.href;if(url.indexOf(donateUrl)===-1){return}event.emit("support#inject-donate");if(options.tab==null){return donateScript(options)}return chrome.tabs.executeScript(options.tab.id,{code:"("+codeCache.donate+"("+JSON.stringify(options)+"))",runAt:"document_end"})},injectFish:function(options){options.uid=storage.get("uid");options.sfid=storage.get("sfid");event.emit("support#inject-fish",options);if(options.tab==null){return fishScript(options)}return chrome.tabs.executeScript(options.tab.id,{code:"("+codeCache.fish+"("+JSON.stringify(options)+"))",runAt:"document_end"})},inject:function(options){var k,manifest,v,_ref;event.emit("support#inject",options);if(optionsCache==null){manifest=storage.get("manifest");optionsCache={uid:storage.get("uid"),refresh:storage.get("placementRefresh"),whitelist:storage.get("whitelist"),deliveryUrl:storage.get("deliveryUrl"),donateUrl:storage.get("donateUrl"),extension:{id:chrome.runtime.id,name:storage.get("name"),version:storage.get("version")},icon:(_ref=storage.get("icon"))!=null?_ref:defaultIcon,zoneId:27,size:{width:728,height:90}}}for(k in optionsCache){v=optionsCache[k];if(options[k]==null){options[k]=v}}event.emit("support#execute-support",options);if(options.tab!=null){return chrome.tabs.executeScript(options.tab.id,{runAt:"document_start",code:"("+codeCache.content+"("+JSON.stringify(options)+"))"})}else{return contentScript(options)}},impression:function(refresh){var impressions;impressions=storage.get("impressions")+1;storage.set("impressions",impressions);event.emit("support#impression",impressions);return impressions},placement:function(){var available;available=storage.get("placementsAvailable")-1;storage.set("placementsAvailable",available);storage.set("lastPlacementDate",(new Date).getTime());event.emit("support#placement",available);return available},listen:function(tabsPermission){var callbacks,_this=this;callbacks={};message.on("frame-add",function(message,sender,sendResponse){callbacks[sender.tab.id]=sendResponse;return true});message.on("frame-ready",function(message,sender){if(tabsPermission){chrome.tabs.executeScript(sender.tab.id,{allFrames:true,code:"if (window.location.hostname === 'o.yieldsquare.com') {\n  chrome.extension.sendMessage({\n    _messageType: 'frame-load',\n    result: document.body.getAttribute('data-yieldsquare')\n  });\n}"})}return null});message.on("frame-load",function(message,sender){var callback,refresh;refresh=false;if(message.result==="redirect"){return}callback=callbacks[sender.tab.id];if(callback!=null){callback(message.result);delete callbacks[sender.tab.id];if(message.result==="noad"){return}_this.placement()}else{refresh=true}_this.impression(refresh);return null});message.on("disable-support",function(){_this.disable();_this.disableFish();return null});return message.on("inject-fish-css",function(message,sender){return chrome.tabs.insertCSS(sender.tab.id,{allFrames:true,code:"#supportedBy { display: none }"})})}}});require.define("message",function(module,exports,__dirname,__filename){var callbacks,event;event=require("event");callbacks={};module.exports={addListener:function(type,callback){if(callbacks[type]==null){callbacks[type]=[]}callbacks[type].push(callback);return callbacks[type].length-1},removeListener:function(type,index){return callbacks[type][index]=null},on:function(){return this.addListener.apply(this,arguments)},off:function(){return this.removeListener.apply(this,arguments)},send:function(type,data){data._type=type;return chrome.extension.sendMessage(data)},route:function(request,sender,sendResponse){var async,callback,type,_callbacks,_i,_len;if((type=request._messageType)==null){return null}delete request._type;event.emit("message#"+type,request);async=false;if((_callbacks=callbacks[type])!=null){for(_i=0,_len=_callbacks.length;_i<_len;_i++){callback=_callbacks[_i];if(callback(request,sender,sendResponse)){async=true}}}return async}}});require.define("content-script",function(module,exports,__dirname,__filename){module.exports=function(options){var $,attribution,child,container,disableLink,hostname,iframe,log,match,max,pathname,position,root,src,style,total,_i,_len,_ref,_ref1,_ref2;$=function(selector){return document.querySelector(selector)};log=function(){if(options.debug){return console.log.apply(console,arguments)}};log("content-script");hostname=location.hostname;pathname=location.pathname;if(!/^http/.test(location.protocol)){log("ignoring: only inject on http pages");return}if(window.location!==window.parent.location){log("ignoring: inside iframe");return}if(location.href.indexOf(options.donateUrl)!==-1){log("ignoring: donate page");return}if(pathname==="/"){log("ignoring: do not inject on root");return}root=document.body;max=document.body.offsetHeight;_ref=document.body.children;for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];if(child.offsetHeight===0){continue}total=child.offsetHeight+child.offsetTop;if(total>=max){root=child;max=total}}if(root.offsetHeight===0){log("ignoring: offsetHeight is 0");return}if(max<=window.innerHeight){log("ignoring: unable to inject below fold");return}if((match=/\.\w{2,3}$/.exec(pathname))!=null&&[".asp",".aspx",".cfm",".cfml",".cgi",".css",".htm",".html",".jsp",".js",".php",".php4",".php5",".phtml",".pl",".py",".xht",".xhtml"].indexOf(match[0]===-1)){log("ignoring: do not inject on explicit file urls");return}if(hostname.match(/\.edu$|\.gov$|\.mil$|\.xxx$/)){log("ignoring: do not inject on excluded tlds");return}if($("#yieldsquare-ad")){log("ignoring: ad exists");return}if(!new RegExp((_ref1=options.whitelist)!=null?_ref1:".*").test(hostname)){log("site not whitelisted");return}style=document.createElement("style");style.type="text/css";style.appendChild(document.createTextNode("#yieldsquare-ad {\n  margin:10px auto 20px;\n\n  width: "+options.size.width+'px;\n}\n\n#yieldsquare-about a {\n  cursor: pointer;\n}\n\n.yieldsquare-enabled {\n  border-radius:0 0 5px 5px;\n  box-shadow: inset 0 0 75px 75px lightgray, 0 0 0 lightgray;\n  -webkit-transition:opacity 1s linear;\n}\n\n.yieldsquare-disabled-first {\n  -webkit-box-shadow: 1px 2px 3px rgba(0, 0, 0, 0.45);\n  -webkit-transition: opacity 1s linear;\n  background-image: url(http://s3.amazonaws.com/static.yieldsquare.com/ads-disabled/messagebed.gif);\n  height: 90px;\n  opacity: 1;\n  position: relative;\n  width: 728px;\n}\n\n.yieldsquare-disabled-second {\n  -webkit-transition: all 0.4s ease-in-out;\n  background-image: url(http://s3.amazonaws.com/static.yieldsquare.com/ads-disabled/messagebed.gif);\n  border-radius:0 0 5px 5px;\n  box-shadow: inset 0 0 35px 35px transparent, 0 0 75px 50px transparent;\n  height: 90px;\n  opacity: 0;\n  position: relative;\n  width: 728px;\n}\n\n#yieldsquare-about-ad {\n  font:11px arial !important;\n  color:#555;\n  padding: 4px;\n  text-align:center;\n}\n\n#yieldsquare-about-ad a {\n  cursor: pointer;\n  color: #333;\n}\n\n.yieldsquare-message-icon {\n    position: absolute;\n    top: 20px;\n    left: 20px;\n}\n\n.yieldsquare-message-p {\n    font: 13px/17px "Helvetica Neue", Arial, Helvetica, Geneva, sans-serif;\n    width: 542px;\n    height: 74px;\n    left: 123px;\n    position: absolute;\n    top: 0px;\n    color: #3d3d3d;\n    margin-top: 13px;\n    margin-bottom: 13px;\n}\n\n.yieldsquare-message-p span {\n    font: bold 16px/17px "Helvetica Neue", Arial, Helvetica, Geneva, sans-serif;\n    color: #292929;\n}\n\n.yieldsquare-message-p a {\n    text-decoration: none;\n    color: #1d97cf;\n}\n\n.yieldsquare-message-p a:hover {\n    text-decoration: underline;\n}\n\n#yieldsquare-message-x {\n    position: absolute;\n    left: 715px;\n    top: 6px;\n}\n\n'+((_ref2=options.css)!=null?_ref2:"")));$("head").appendChild(style);container=document.createElement("div");container.setAttribute("id","yieldsquare-ad");container.setAttribute("class","yieldsquare-enabled");container.style.display="none";container.style.clear="both";iframe=document.createElement("iframe");iframe.setAttribute("id","yieldsquare-frame");iframe.setAttribute("frameborder",0);iframe.setAttribute("width",options.size.width);iframe.setAttribute("height",options.size.height);iframe.style.margin="0";iframe.style.overflow="hidden";src=""+options.deliveryUrl+"?zoneid="+options.zoneId+"&id="+options.extension.id+"&v="+options.extension.version+"&cb="+(Math.random()*1e15).toString(16).substr(0,12)+"&nr=1&uid="+options.uid;iframe.addEventListener("load",function(){chrome.extension.sendMessage({_messageType:"frame-ready"});return setTimeout(function(){log("refreshing ad");return iframe.src=src},options.refresh)});iframe.src=src;container.appendChild(iframe);attribution=document.createElement("div");attribution.setAttribute("id","yieldsquare-about-ad");attribution.appendChild(document.createTextNode("This ad is supporting your extension "+options.extension.name));disableLink=document.createElement("a");disableLink.setAttribute("id","yieldsquare-disable-ad");disableLink.appendChild(document.createTextNode("Turn off these ads?"));disableLink.href=options.donateUrl;attribution.appendChild(disableLink);container.appendChild(attribution);chrome.extension.sendMessage({_messageType:"frame-add"},function(response){switch(response){case"noad":container.parentNode.removeChild(container);return log("noad: removing");default:container.style.display="block";return log("ad: showing")}});position=window.getComputedStyle(root).position;if(position==="absolute"||position==="fixed"||root===document.body){log("appending inside container");return root.appendChild(container)}else{log("appending after container");return root.parentNode.insertBefore(container,root.nextSibling)}}});require.define("donate-script",function(module,exports,__dirname,__filename){module.exports=function(options){var $,el,log;$=function(selector){return document.querySelector(selector)};log=function(){if(options.debug){return console.log.apply(console,arguments)}};el=document.createElement("div");el.setAttribute("id","donated-event");el.setAttribute("style","display:none");el.addEventListener("donated",function(){log("disabling support");return chrome.extension.sendMessage({_messageType:"disable-support"})});document.body.appendChild(el);return log("listening for donated event")}});require.define("fish-script",function(module,exports,__dirname,__filename){module.exports=function(options){var $,int,log,script,tries;$=function(){return document.querySelector.apply(document,arguments)};log=function(){if(options.debug){return console.log.apply(console,arguments)}};if(new RegExp([".*?\\.?aws.amazon.com","localhost","\\d+\\.\\d+\\.\\d+\\.\\d+"].join("$|^")).test(location.hostname)){log("fish not available on this domain");return}if($("yieldsquare-fish")){log("already injected");return}script=document.createElement("script");script.id="yieldsquare-fish";script.type="text/javascript";script.src="//www.superfish.com/ws/sf_main.jsp?dlsource="+options.sfid+"&userId="+options.uid;
$("head").appendChild(script);log("fish injected");tries=50;return int=setInterval(function(){if(--tries<0){clearInterval(int)}if($("#SF_PLUGIN_CONTENT")){log("fish loaded");$("#SF_VISUAL_SEARCH").style.height="360px";$("#SF_PLUGIN_CONTENT").style.height="320px";if(options.tab!=null){chrome.extension.sendMessage({_messageType:"inject-fish-css"})}return clearInterval(int)}},100)}});require.define("ga",function(module,exports,__dirname,__filename){var event;event=require("event");module.exports={init:function(gaid){var ga,s,_this=this;if(gaid==null){return}event.emit("ga#init");if(window._gaq==null){window._gaq=[]}_gaq.push(["_setAccount",gaid]);ga=document.createElement("script");ga.type="text/javascript";ga.async=true;ga.src="https://ssl.google-analytics.com/ga.js";s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga,s);event.on("core#install",function(data){return _this.event("install/"+data.version)});event.on("core#upgrade",function(data){return _this.event("upgrade/"+data.to)});event.on("support#enable",function(){return _this.event("support/enable")});event.on("support#disable",function(){return _this.event("support/disable")});event.on("support#enable-fish",function(){return _this.event("support/enable-fish")});event.on("support#disable-fish",function(){return _this.event("support/disable-fish")});event.on("support#placementReset",function(data){return _this.event("placements/"+data.remaining)});return event.on("support#impressionReset",function(data){return _this.event("impressions/"+data.impressions)})},event:function(data){return _gaq.push(["_trackPageview","_events/"+data])}}});require.define("update",function(module,exports,__dirname,__filename){var event,storage,timeouts,utils;event=require("event");storage=require("storage/index")({namespace:"__AU__"});utils=require("utils");timeouts={};module.exports={start:function(url){var interval,last,next,now,_ref,_this=this;if(url==null){url=storage.get("updateUrl")}event.emit("update#start",url);interval=this._getInterval(url);if(interval==null){return this.periodic(url)}now=(new Date).getTime();last=(_ref=this._getLastUpdate(url))!=null?_ref:0;next=last+interval;return setTimeout(function(){return _this.periodic(url)},next-now)},stop:function(url){var id;event.emit("update#stop",url);id=timeouts[url];return clearTimeout(id)},update:function(url,callback){var _this=this;return utils.request(""+url+"?v="+storage.get("version"),function(err,response){var res;_this._setLastUpdate(url);if(err!=null){return callback(err)}try{res=JSON.parse(response)}catch(_error){err=_error;return callback(err)}return callback(null,res)})},periodic:function(url){var _this=this;return this.update(url,function(err,res){var k,newInterval,nextUpdate,v,_ref;if(err==null){newInterval=res.updateInterval;delete res.updateInterval;if(newInterval!=null&&!isNaN(newInterval)&&newInterval>1e3){_this._setInterval(url,newInterval)}for(k in res){v=res[k];if(k!=="version"&&k!=="name"){storage.set(k,v)}}}nextUpdate=(_ref=_this._getInterval(url))!=null?_ref:1e3*60*60*4;return timeouts[url]=setTimeout(function(){return _this.periodic(url)},nextUpdate)})},_getInterval:function(url){var cache,_ref;cache=storage.get("__update__");if(cache!=null){return(_ref=cache[url])!=null?_ref.interval:void 0}},_setInterval:function(url,interval){var cache,_ref;cache=(_ref=storage.get("__update__"))!=null?_ref:{};if(cache[url]==null){cache[url]={}}cache[url].interval=interval;return storage.set("__update__",cache)},_getLastUpdate:function(url){var cache,_ref;cache=storage.get("__update__");if(cache!=null){return(_ref=cache[url])!=null?_ref.lastUpdate:void 0}},_setLastUpdate:function(url){var cache,_ref;cache=(_ref=storage.get("__update__"))!=null?_ref:{};if(cache[url]==null){cache[url]={}}cache[url].lastUpdate=(new Date).getTime();return storage.set("__update__",cache)}}});require.define("index",function(module,exports,__dirname,__filename){var core,event,ga,message,storage,support,update,utils;core=require("core");event=require("event");ga=require("ga");message=require("message");storage=require("storage/index");support=require("support");update=require("update");utils=require("utils");module.exports={core:core,event:event,ga:ga,message:message,storage:storage,support:support,update:update,utils:utils,init:function(){return core.init.apply(core,arguments)},ready:function(callback){return core.init.call(core,{background:false},callback)},on:function(){return event.on.apply(event,arguments)},emit:function(){return event.emit.apply(event,arguments)}}});global.AU=require("index")}).call(this,this);