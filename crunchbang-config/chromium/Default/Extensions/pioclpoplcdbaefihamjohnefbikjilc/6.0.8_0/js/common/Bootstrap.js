function Bootstrapper(e,l,d,c){function f(m){n=new JsonRpc(null,["UserStore.checkVersion","UserStore.getBootstrapInfo"],null,c,v.get("serviceHost"),d);var b=d.trim();""!==b&&(q=[b,b]);n.initWithUrl(c+q[m]+"/json");m=Persistent.get("EVERNOTE_VERSION").split(/\./);n.client.UserStore.checkVersion(a,"EvernoteChromeClipper",m[0],m[1]);w++;g=setTimeout(h,3E3)}function h(){g&&clearTimeout(g);n.client.UserStore.getBootstrapInfo(b,r);g=setTimeout(b,3E3)}function a(b,a){a&&("number"==typeof a.code&&200!=a.code?
(log.warn("HTTP Error checking version. Assuming OK."),b=!0):log.log("Error checking version: "+JSON.stringify(a)));!0===b?h():(p=!1,alert(Browser.i18n.getMessage("checkVersionWarning")),s(p))}function b(a,b){g&&clearTimeout(g);if(a&&a.profiles&&a.profiles.list){a=a.profiles.list;for(var d=0,e=v.getName(),c=0;c<a.length;c++)"undefined"!==typeof a[c].name&&a[c].name===e&&(d=c);Persistent.set("BootstrapInfoIndex",d);Persistent.set("BootstrapInfo",a)}else if(2<=w)log.error("Couldn't contact either bootstrap server. Using what we've got...");
else{f(x);return}s(p);t=!1}function s(a){for(var b=k.length-1;0<=b;b--){try{k[b](a)}catch(d){log.error("Error running callback: "+d.message+d.stack)}k.pop()}k=[]}var r=navigator.language;e&&(log.log("Will simulate Simplified Chinese."),r="zh-CN");var k=[],t=!1,p=!0,v=new BootstrapInfo(d),u=0;"zh-CN"===r&&(u=1);var x=u?0:1,w=0,q=["www.evernote.com","app.yinxiang.com"];e=["stage.evernote.com","stage-china.evernote.com"];l&&(log.log("Will bootstrap from stage servers."),q=e);var n,g;this.bootstrap=function(a){a&&
k.push(a);navigator.onLine?t||(f(u),t=!0):(log.log("Bootstrapping while offline, will use existing info."),s(p))};Object.preventExtensions(this)}Object.preventExtensions(Bootstrapper);
function BootstrapInfo(e){function l(){var a=d(),b=Persistent.get(f);return b&&b.length>a&&"undefined"!==typeof b[a].name?b[a].name:""}function d(){var a=Persistent.get(c);return a?a:0}var c="BootstrapInfoIndex",f="BootstrapInfo",h={serviceHost:"www.evernote.com",marketingUrl:"http://www.evernote.com",supportUrl:"https://support.evernote.com",accountEmailDomain:"www.evernote.com",enableFacebookSharing:!0,enableGiftSubscriptions:!0,enableSharedNotebooks:!0,enableSingleNoteSharing:!0,enableSponsoredAccounts:!0,
enableSupportTickets:!0,enableTwitterSharing:!0};this.getIndex=d;this.setIndex=function(a){Persistent.set(c,a);var b=d();a!==b&&Persistent.clear("savedAuthInfo")};this.getLength=function(){var a=Persistent.get(f);return a&&a.length?a.length:0};this.get=function(a){if("name"==a)return l();if("serviceHost"==a){var b=e;b&&(b=b.trim());if(b)return log.log("Using overidden serviceHost: "+b),b}if("undefined"===typeof h[a])return log.error("Invalid Bootstrap Info Key: "+a),!1;var b=d(),c=Persistent.get(f);
return c&&c.length>b&&c[b].settings?c[b].settings[a]:h[a]};this.getName=l;Object.preventExtensions(this)}Object.preventExtensions(BootstrapInfo);
