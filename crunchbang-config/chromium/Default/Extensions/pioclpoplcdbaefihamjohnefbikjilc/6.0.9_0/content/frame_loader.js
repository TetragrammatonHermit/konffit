if(window==window.parent){var frameData={},completed=!1,addedEventListeners=!1,timeout,countSerializableFrames=function(){for(var a=document.querySelectorAll("iframe"),c=0,b=0;b<a.length;b++)a[b].dataset&&a[b].dataset.en_id&&c++;return c},completedFrameCount=function(){var a=0,c;for(c in frameData)a++;return a},serializeFrames=function(a){function c(){completed||(log.warn("Some frames seem stuck, continuing with what we've got."),completed=!0,a(frameData))}0==countSerializableFrames()?a(null):(addedEventListeners||
(window.addEventListener("message",function(b){b&&b.data&&b.data.name&&"EN_serialized"==b.data.name?(frameData[b.data.id]=b.data.data,clearTimeout(timeout),completed||(completedFrameCount()==countSerializableFrames()?(completed=!0,a(frameData)):timeout=setTimeout(c,2E3))):b&&b.data&&b.data.name&&"main_getTextResource"==b.data.name&&Browser.sendToExtension({name:"main_getTextResource",href:b.data.href})},!1),addedEventListeners=!0),frameData={},completed=!1,timeout=setTimeout(c,2E3),Browser.sendToExtension({name:"bounce",
message:{name:"startSerialize"}}))};Browser.addMessageHandlers({content_textResource:function(a,c,b){window.postMessage(a,"*")}})}else Browser.addMessageHandlers({startSerialize:function(a,c,b){script=document.createElement("script");script.type="text/javascript";script.textContent="serializeFrame();";document.head.appendChild(script)}},!0);var addedScripts=!1;
Browser.addMessageHandlers({insertSerializationScripts:function(a,c,b){window==window.parent||addedScripts||(document.head&&!document.querySelector("script[src='"+Browser.extension.getURL("js/GlobalUtils.js")+"']")&&(a=document.createElement("script"),a.type="text/javascript",a.src=Browser.extension.getURL("js/GlobalUtils.js"),document.head.appendChild(a)),document.head&&!document.querySelector("script[src='"+Browser.extension.getURL("content/HtmlSerializer.js")+"']")&&(a=document.createElement("script"),
a.type="text/javascript",a.src=Browser.extension.getURL("content/HtmlSerializer.js"),document.head.appendChild(a)));addedScripts||!document.head||document.querySelector("script[src='"+Browser.extension.getURL("content/frame.js")+"']")||(a=document.createElement("script"),a.type="text/javascript",a.src=Browser.extension.getURL("content/frame.js"),document.head.appendChild(a),addedScripts=!0)}},!0);
