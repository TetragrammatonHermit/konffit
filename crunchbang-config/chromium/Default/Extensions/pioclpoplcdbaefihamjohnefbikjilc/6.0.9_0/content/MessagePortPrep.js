var port,secret,tempPortEvt;function startSecretGeneration(){Browser.sendToExtension({name:"generateSecret",for:window.NAME})}function receivePort(a){a.data.secret===secret?(port=a.ports[0],"function"===typeof onMessage&&port.addEventListener("message",onMessage),port.start(),"function"===typeof portReady&&portReady(),port.postMessage({name:window.NAME+"Ready"})):log.error("secrets did not match for "+window.NAME)}
function receiveSecret(a,b,c){a.for===window.NAME&&(secret=a.secret,tempPortEvt&&receivePort(tempPortEvt))}Browser.addMessageHandlers({receiveSecret:receiveSecret});window.addEventListener("message",function(a){"receivePort"==a.data.name&&(secret?receivePort(a):tempPortEvt=a)});
