var AutoComplete=function(w,l){function n(a){var b=-1,c="";$.each(g.multipleSeparator,function(d,h){var i;if((i=a.lastIndexOf(h))>b){c=h;b=i}});return[b,c]}function o(){e.hide()}function p(a){switch(a.keyCode){case 38:a.preventDefault();k(-1);g.moveToSelect==true&&q();break;case 40:a.preventDefault();k(1);g.moveToSelect==true&&q();break;case 9:case 13:if(g.moveToSelect)e.hide();else if(e.is(":visible")){r()?e.hide():k(1);a.preventDefault();a.stopPropagation()}break;case 27:if(e.is(":visible")){a.preventDefault();
a.stopPropagation();e.hide()}break;case 32:if(e.is(":visible")){a.stopPropagation();e.hide()}s=f.val();break;default:j=-1;m&&clearTimeout(m);m=setTimeout(function(){f.val().length<g.minChars?e.hide():x(f.val())},g.delay);break}}function q(){var a=e.find("li").eq(j).html();f.val(a)}function r(a){if(a!==undefined){j=a;k(0)}a=j;if(!(a<0)){var b=e.find("li").eq(a).html();if(b.indexOf(" ")>=0)b='"'+b+'"';if(g.mode=="multiple"){a=f.val();var c=n(a);new_value=c[0]>=1?a.substr(0,c[0]+1)+b+c[1]:b+" "}else new_value=
b;f.val(new_value);f.trigger("input");e.hide();g.onItemSelect&&setTimeout(function(){g.onItemSelect(b)},1);setTimeout(function(){f[0].focus();(function(d,h){if(d.createTextRange){var i=d.createTextRange();i.move("character",h);i.select()}else if(d.selectionStart>=0){d.focus();d.setSelectionRange(h,h)}})(f[0],f.val().length)},13);return true}}function k(a){var b=e.find("li");if(b.size()!=0){j+=a;if(j<0)j=b.size()-1;else if(j>=b.size())j=0;b.removeClass("over").eq(j).addClass("over")}}function x(a){if(g.mode==
"multiple"){var b=n(a),c="";c=b[0]>0?a.substr(b[0]+1):a;t=a.substring(0,b[0])==""?a.substring(0,b[0]):a.substring(0,b[0])+" ";if(c.length>0){tags=ParseTags.parseTags(c,true);a=tags.pop()}else{a=c;e.hide();return}}var d=a.toLowerCase();a=d;console.log(a);b=[];var h=[];if(g.moveToSelect==true)if(a.indexOf("#")==0)a=a.slice(1);console.log(a);c=0;for(var i;i=g.data[c],c<g.data.length;c++)if(i.toLowerCase().indexOf(a)==0)d.indexOf("#")==0?b.push("#"+i):b.push(i);else if(i.toLowerCase().indexOf(a)!=0&&
i.toLowerCase().indexOf(a)!=-1)d.indexOf("#")==0?h.push("#"+i):h.push(i);h.sort(function(y,z){return y.indexOf(a)<=z.indexOf(a)?-1:1});b=b.concat(h);d=[];for(c=0;c<b.length;c++){if(b[c].indexOf("#")!=-1&&b[c].indexOf(" ")!=-1){h=b[c].slice(1);h='#"'+h+'"'}else h=b[c];d.push(t+h)}g.moveToSelect?u(a,d):u(a,b)}function u(a,b){if(b&&b.length>0){b.length>7&&b.splice(7,99999);var c=function(d){for(var h=d.offsetLeft||0,i=d.offsetTop||0;d=d.offsetParent;){h+=d.offsetLeft;i+=d.offsetTop}if($.browser.opera&&
document.compatMode!="CSS1Compat")i+=30;return{x:h+0,y:i+0}}(f[0]);e.find("li").unbind();e.find("ul").html($.map(b,function(d){return"<li>"+d+"</li>"}).join("")).end().css({top:g.moveToSelect?c.y+f[0].offsetHeight-4:c.y+f[0].offsetHeight,left:c.x}).show();e.find("li").mouseover(function(d){j=e.find("li").index(d.target);k(0)}).mousedown(function(d){j=e.find("li").index(d.target);k(0);r();return false})}else e.hide()}function v(){e.hide()}var f=$(w),m,j=-1,s=null,t=null;f[0].autoCompleter&&f[0].autoCompleter.destroy();
f[0].autoCompleter=this;var g=l=$.extend({inputClass:"ac_input",moveToSelect:false,resultsClass:"ac_results",minChars:1,delay:100,matchCase:0,matchSubset:1,matchContains:0,mustMatch:0,loadingClass:"ac_loading",selectFirst:false,selectOnly:false,mode:"multiple",multipleSeparator:" "},l||{});if(typeof g.multipleSeparator=="string")g.multipleSeparator=g.multipleSeparator.split("");this.destroy=function(){f.unbind("keydown",p).unbind("blur",v);f.on("input",function(){s=f.val()});$(window).unbind("scroll",
o);f[0].autoCompleter=null};f.attr("autocomplete","off").addClass(g.inputClass).bind("keydown",p).bind("blur",v).bind("click",function(){setTimeout(function(){f.val()==""&&e.hide()},100)});$.browser.supportPositionFixed||$(window).bind("scroll",o);var e=$("#"+l.id);if(e.size()==0){e=$('<div id="'+l.id+'"><ul></ul></div>').addClass(g.resultsClass).hide().css({position:$.browser.supportPositionFixed?"fixed":"absolute"}).appendTo(document.body).hide();$.browser.ieBelow7&&e.append(document.createElement("<iframe class=\"bgiframe\" src=\"javascript:false;document.write('');\" tabindex=\"-1\" style=\"display:block; position:absolute; top: expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)  || 0) * -1) + 'px'); left:expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth) || 0) * -1) + 'px'); z-index:-1; filter:Alpha(Opacity='0'); width:expression(this.parentNode.offsetWidth + 'px'); height:expression(this.parentNode.offsetHeight + 'px')\"/>"))}};
