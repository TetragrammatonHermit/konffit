importScripts("../common/WebWorkerHelper.js");importScripts("../../third_party/IndexedDBShim.min.js");importScripts("../common/IDB.js");var num=0;function logCallback(b){self.postMessage({name:"log",msg:b})}function transform(b){b=JSON.stringify(b);for(var a=new ArrayBuffer(2*b.length),d=new Uint16Array(a),c=0;c<b.length;c++)d[c]=b.charCodeAt(c);return a}
self.addEventListener("message",function(b){"notebooks"==b.data.type?(IDB.getGroup(b.data.userId,"notebooks",null,null,function(a){a&&(a=transform(a),self.postMessage({name:"persNotebooks",notebooks:a},[a]));2<=++num&&self.close()},logCallback),IDB.getGroup(b.data.userId,"sharedNotebooks",null,null,function(a){a&&(a=transform(a),self.postMessage({name:"sharedNotebooks",notebooks:a},[a]));2<=++num&&self.close()},logCallback)):"tags"==b.data.type&&(IDB.getGroup(b.data.userId,"tags",null,null,function(a){a&&
(a=transform(a),self.postMessage({name:"persTags",tags:a},[a]));2<=++num&&self.close()},logCallback),IDB.getGroup(b.data.userId,"bizTags",null,null,function(a){a&&(a=transform(a),self.postMessage({name:"bizTags",tags:a},[a]));2<=++num&&self.close()},logCallback))});
