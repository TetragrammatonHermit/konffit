var Name=function(){function l(a){this.name=a}l.prototype={};return l}(),Cmd=function(){function l(a){this.cmd=a}l.prototype={};var a={};l.get=function(b){var d=a[b];return d?d:a[b]=new l(b)};return l}(),Dict=function(){function l(a){var b=Object.create(null);this.assignXref=function(b){a=b};this.get=function(d,e,f){var c;if("undefined"!=typeof(c=b[d])||d in b||"undefined"==typeof e||"undefined"!=typeof(c=b[e])||e in b||"undefined"==typeof f)return a?a.fetchIfRef(c):c;c=b[f]||null;return a?a.fetchIfRef(c):
c};this.getRaw=function(a){return b[a]};this.getAll=function(){var a={},e;for(e in b){var f=this.get(e);a[e]=f instanceof l?f.getAll():f}return a};this.set=function(a,e){b[a]=e};this.has=function(a){return a in b};this.forEach=function(a){for(var e in b)a(e,this.get(e))}}return l}(),Ref=function(){function l(a,b){this.num=a;this.gen=b}l.prototype={};return l}(),RefSet=function(){function l(){this.dict={}}l.prototype={has:function(a){return!!this.dict["R"+a.num+"."+a.gen]},put:function(a){this.dict["R"+
a.num+"."+a.gen]=a}};return l}(),Catalog=function(){function l(a){this.xref=a;a=a.getCatalogObj();assertWellFormed(isDict(a),"catalog object is not a dictionary");this.catDict=a}l.prototype={get metadata(){var a=this.catDict.getRaw("Metadata");if(!isRef(a))return shadow(this,"metadata",null);var a=this.xref.fetch(a,!(this.xref.encrypt&&this.xref.encrypt.encryptMetadata)),b;if(a&&isDict(a.dict)){var d=a.dict.get("Type"),e=a.dict.get("Subtype");if(isName(d)&&isName(e)&&"Metadata"===d.name&&"XML"===
e.name)try{b=stringToUTF8String(bytesToString(a.getBytes()))}catch(f){info("Skipping invalid metadata.")}}return shadow(this,"metadata",b)},get toplevelPagesDict(){var a=this.catDict.get("Pages");assertWellFormed(isDict(a),"invalid top-level pages dictionary");return shadow(this,"toplevelPagesDict",a)},get documentOutline(){var a=this.xref,b=this.catDict.get("Outlines"),d={items:[]};if(isDict(b)){var b=b.getRaw("First"),e=new RefSet;if(isRef(b)){var f=[{obj:b,parent:d}];for(e.put(b);0<f.length;){var c=
f.shift(),h=a.fetchIfRef(c.obj);if(null!==h){h.has("Title")||error("Invalid outline item");(b=h.get("A"))?b=b.get("D"):h.has("Dest")&&(b=h.getRaw("Dest"),isName(b)&&(b=b.name));var k=h.get("Title"),k={dest:b,title:stringToPDFString(k),color:h.get("C")||[0,0,0],count:h.get("Count"),bold:!!(h.get("F")&2),italic:!!(h.get("F")&1),items:[]};c.parent.items.push(k);b=h.getRaw("First");isRef(b)&&!e.has(b)&&(f.push({obj:b,parent:k}),e.put(b));b=h.getRaw("Next");isRef(b)&&!e.has(b)&&(f.push({obj:b,parent:c.parent}),
e.put(b))}}}}b=0<d.items.length?d.items:null;return shadow(this,"documentOutline",b)},get numPages(){var a=this.toplevelPagesDict.get("Count");assertWellFormed(isInt(a),"page count in top level pages object is not an integer");return shadow(this,"num",a)},traverseKids:function(a){var b=this.pageCache;a=a.get("Kids");assertWellFormed(isArray(a),"page dictionary kids object is not an array");for(var d=0,e=a.length;d<e;++d){var f=a[d];assertWellFormed(isRef(f),"page dictionary kid is not a reference");
var c=this.xref.fetch(f);isDict(c,"Page")||isDict(c)&&!c.has("Kids")?b.push(new Page(this.xref,b.length,c,f)):(assertWellFormed(isDict(c),"page dictionary kid reference points to wrong type of object"),this.traverseKids(c))}},get destinations(){function a(a){return isDict(a)?a.get("D"):a}var b=this.xref,d={},e,f,c=this.catDict.get("Names");c?e=c.getRaw("Dests"):this.catDict.has("Dests")&&(f=this.catDict.get("Dests"));f&&f.forEach(function(b,c){c&&(d[b]=a(c))});if(e)for(f=new RefSet,f.put(e),e=[e];0<
e.length;){var h,c=b.fetch(e.shift());if(c.has("Kids")){var k=c.get("Kids"),c=0;for(h=k.length;c<h;c++){var g=k[c];f.has(g)&&error("invalid destinations");e.push(g);f.put(g)}}else if(k=c.get("Names"))for(c=0,h=k.length;c<h;c+=2)d[k[c]]=a(b.fetchIfRef(k[c+1]))}return shadow(this,"destinations",d)},getPage:function(a){this.pageCache||(this.pageCache=[],this.traverseKids(this.toplevelPagesDict));return this.pageCache[a-1]}};return l}(),XRef=function(){function l(a,b,d,e){this.stream=a;this.entries=[];
this.xrefstms={};a=this.readXRef(b);a.assignXref(this);this.trailer=a;this.cache=[];if(b=a.get("Encrypt"))d=a.get("ID"),this.encrypt=new CipherTransformFactory(b,d[0],e);(this.root=a.get("Root"))||error("Invalid root reference")}l.prototype={readXRefTable:function(a){for(var b;!isCmd(b=a.getObj(),"trailer");){var d=a.getObj();isInt(b)&&isInt(d)||error("Invalid XRef table: wrong types in subsection header");for(var e=0;e<d;e++){var f={};f.offset=a.getObj();f.gen=a.getObj();var c=a.getObj();isCmd(c,
"f")?f.free=!0:isCmd(c,"n")&&(f.uncompressed=!0);isInt(f.offset)&&isInt(f.gen)&&(f.free||f.uncompressed)||error("Invalid entry in XRef subsection: "+b+", "+d);this.entries[e+b]||(this.entries[e+b]=f)}}this.entries[0]&&!this.entries[0].free&&error("Invalid XRef table: unexpected first object");isCmd(b,"trailer")||error("Invalid XRef table: could not find trailer dictionary");a=a.getObj();isDict(a)||error("Invalid XRef table: could not parse trailer dictionary");return a},readXRefStream:function(a){var b=
a.parameters,d=b.get("W"),e=b.get("Index");e||(e=[0,b.get("Size")]);for(var f,c;0<e.length;){var h=e[0],k=e[1];isInt(h)&&isInt(k)||error("Invalid XRef range fields: "+h+", "+k);var g=d[0],l=d[1],q=d[2];isInt(g)&&isInt(l)&&isInt(q)||error("Invalid XRef entry fields length: "+h+", "+k);for(f=0;f<k;++f){var n=0,m=0,p=0;for(c=0;c<g;++c)n=n<<8|a.getByte();0==g&&(n=1);for(c=0;c<l;++c)m=m<<8|a.getByte();for(c=0;c<q;++c)p=p<<8|a.getByte();c={};c.offset=m;c.gen=p;switch(n){case 0:c.free=!0;break;case 1:c.uncompressed=
!0;break;case 2:break;default:error("Invalid XRef entry type: "+n)}this.entries[h+f]||(this.entries[h+f]=c)}e.splice(0,2)}return b},indexObjects:function(){function a(a,b){for(var c="",d=a[b];13!==d&&10!==d&&!(++b>=a.length);)c+=String.fromCharCode(d),d=a[b];return c}function b(a,b,c){for(var d=c.length,e=a.length,f=0;b<e;){for(var g=0;g<d&&a[b+g]==c[g];)++g;if(g>=d)break;b++;f++}return f}var d=new Uint8Array([116,114,97,105,108,101,114]),e=new Uint8Array([115,116,97,114,116,120,114,101,102]),f=new Uint8Array([101,
110,100,111,98,106]),c=new Uint8Array([47,88,82,101,102]),h=this.stream;h.pos=0;for(var k=h.getBytes(),g=h.start,l=k.length,q=[],n=[];g<l;){var m=k[g];if(32===m||9===m||13===m||10===m)++g;else if(37===m){do++g,m=k[g];while(13!==m&&10!==m)}else{var m=a(k,g),p;if("xref"===m)g+=b(k,g,d),q.push(g),g+=b(k,g,e);else if(p=/^(\d+)\s+(\d+)\s+obj\b/.exec(m)){this.entries[p[1]]={offset:g,gen:p[2]|0,uncompressed:!0};m=b(k,g,f)+7;p=k.subarray(g,g+m);var s=b(p,0,c);s<m&&64>p[s+5]&&(n.push(g),this.xrefstms[g]=1);
g+=m}else g+=m.length+1}}d=0;for(e=n.length;d<e;++d)this.readXRef(n[d],!0);for(var r,d=0,e=q.length;d<e;++d)if(h.pos=q[d],n=new Parser(new Lexer(h),!0,null),f=n.getObj(),isCmd(f,"trailer")&&isDict(r=n.getObj())&&r.has("ID"))return r;if(r)return r;throw new InvalidPDFException("Invalid PDF structure");},readXRef:function(a,b){var d=this.stream;d.pos=a;try{var e=new Parser(new Lexer(d),!0,null),f=e.getObj(),c;isCmd(f,"xref")?(c=this.readXRefTable(e),f=c.get("XRefStm"),isInt(f)&&(d=f,d in this.xrefstms||
(this.xrefstms[d]=1,this.readXRef(d)))):isInt(f)&&(isInt(e.getObj())&&isCmd(e.getObj(),"obj")&&isStream(f=e.getObj())||error("Invalid XRef stream"),(c=this.readXRefStream(f))||error("Failed to read XRef stream"));f=c.get("Prev");isInt(f)?this.readXRef(f,b):isRef(f)&&this.readXRef(f.num,b);return c}catch(h){log("(while reading XRef): "+h)}if(!b)return warn("Indexing all PDF objects"),this.indexObjects()},getEntry:function(a){a=this.entries[a];return null===a?null:a.free||!a.offset?null:a},fetchIfRef:function(a){return isRef(a)?
this.fetch(a):a},fetch:function(a,b){assertWellFormed(isRef(a),"ref object is not a reference");var d=a.num;if(d in this.cache)return this.cache[d];var e=this.getEntry(d);if(null===e)return this.cache[d]=e;var f=a.gen,c;if(e.uncompressed){e.gen!=f&&error("inconsistent generation in XRef");c=this.stream.makeSubStream(e.offset);c=new Parser(new Lexer(c),!0,this);var h=c.getObj(),k=c.getObj(),g=c.getObj();isInt(h)&&h==d&&isInt(k)&&k==f&&isCmd(g)||error("bad XRef entry");if(!isCmd(g,"obj")){if(0==g.cmd.indexOf("obj")&&
(d=parseInt(g.cmd.substring(3),10),!isNaN(d)))return d;error("bad XRef entry")}if(this.encrypt&&!b)try{e=c.getObj(this.encrypt.createCipherTransform(d,f))}catch(l){return this.fetch(a,!0)}else e=c.getObj();if(!isStream(e)||e instanceof JpegStream)this.cache[d]=e;return e}f=e.offset;c=this.fetch(new Ref(f,0));isStream(c)||error("bad ObjStm stream");d=c.parameters.get("First");h=c.parameters.get("N");isInt(d)&&isInt(h)||error("invalid first and n parameters for ObjStm stream");c=new Parser(new Lexer(c),
!1,this);c.allowStreams=!0;for(var g=[],q=[],k=0;k<h;++k)d=c.getObj(),isInt(d)||error("invalid object number in the ObjStm stream: "+d),q.push(d),d=c.getObj(),isInt(d)||error("invalid object offset in the ObjStm stream: "+d);for(k=0;k<h;++k){g.push(c.getObj());var d=q[k],n=this.entries[d];n&&n.offset===f&&n.gen===k&&(this.cache[d]=g[k])}(e=g[e.gen])||error("bad XRef entry for compressed object");return e},getCatalogObj:function(){return this.root}};return l}(),PDFObjects=function(){function l(){this.objs=
{}}l.prototype={ensureObj:function(a,b){return this.objs[a]?this.objs[a]:this.objs[a]=new Promise(a,b)},get:function(a,b){if(b)return this.ensureObj(a).then(b),null;var d=this.objs[a];d&&d.isResolved||error("Requesting object that isn't resolved yet "+a);return d.data},resolve:function(a,b){var d=this.objs;d[a]?d[a].resolve(b):this.ensureObj(a,b)},onData:function(a,b){this.ensureObj(a).onData(b)},isResolved:function(a){var b=this.objs;return b[a]?b[a].isResolved:!1},hasData:function(a){var b=this.objs;
return b[a]?b[a].hasData:!1},getData:function(a){var b=this.objs;return b[a]&&b[a].hasData?b[a].data:null},setData:function(a,b){this.ensureObj(a).data=b},clear:function(){this.objs={}}};return l}();
